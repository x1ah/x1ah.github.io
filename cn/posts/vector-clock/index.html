<!doctype html><html lang=cn><head><title>向量时钟(Vector Clock) :: x1ah</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="向量时钟(Vector Clock) 是分布式系统中检测事件因果关系的一种算法, 通常在分布式系统中用来检测多个 replication 之间是否发生数据冲突。"><meta name=keywords content="Distributed"><meta name=robots content="noodp"><link rel=canonical href=https://when.run/cn/posts/vector-clock/><script async src="https://www.googletagmanager.com/gtag/js?id=G-21PQZQT56W"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-21PQZQT56W",{anonymize_ip:!1})}</script><link rel=stylesheet href=https://when.run/assets/style.css><link rel=apple-touch-icon href=https://when.run/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://when.run/avator.jpeg><meta name=twitter:card content="summary"><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="og:title" content="向量时钟(Vector Clock)"><meta property="og:description" content="向量时钟(Vector Clock) 是分布式系统中检测事件因果关系的一种算法, 通常在分布式系统中用来检测多个 replication 之间是否发生数据冲突。"><meta property="og:url" content="https://when.run/cn/posts/vector-clock/"><meta property="og:site_name" content="x1ah"><meta property="og:image" content="https://when.run/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-11-08 00:00:00 +0000 UTC"><script async src="https://www.googletagmanager.com/gtag/js?id=G-21PQZQT56W"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-21PQZQT56W",{anonymize_ip:!1})}</script></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>x1ah</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/cn/about/>About</a></li><li><a href=/cn/index.xml>RSS</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/cn/about/>About</a></li><li><a href=/cn/index.xml>RSS</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://when.run/cn/posts/vector-clock/>向量时钟(Vector Clock)</a></h1><div class=post-meta><span class=post-date>2019-11-08
</span><span class=post-author>:: x1ah</span></div><span class=post-tags>#<a href=https://when.run/cn/tags/distributed/>Distributed</a>&nbsp;</span><div class=post-content><div><h2 id=向量时钟vector-clock>向量时钟(Vector Clock)<a href=#向量时钟vector-clock class=hanchor arialabel=Anchor>&#8983;</a></h2><p>向量时钟是在分布式系统中检测事件因果关系的一种算法。如图：<img alt=Imgur src=https://i.imgur.com/0XRtT9o.png></p><p>系统中有 ABC 三个进程，每个进程都维护自己的一个向量时钟，时钟的规则如下：</p><ol><li>初始时，所有进程的时钟都为 0</li><li>进程每次处理一个内部事件，其逻辑时钟加 1</li><li>每次发送消息，其逻辑时钟加 1，并且将其向量时钟一起发送</li><li>每次收到消息，其逻辑时钟加 1，并更新本地时钟，逻辑时钟的值为本地时钟里值的最大值</li></ol><p>每个进程维护的所有逻辑时钟为一个向量时钟。假设进程 A 向量时钟如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>+----+</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>A:<span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>B:<span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span>  <span style=color:#f92672>===&gt;</span>  这个整体称为 A 的 <span style=color:#e6db74>&#34;向量时钟&#34;</span><span style=color:#960050;background-color:#1e0010>，</span>其中<span style=color:#960050;background-color:#1e0010>，</span>A:<span style=color:#ae81ff>0</span> 为 A 的逻辑时钟
</span></span><span style=display:flex><span><span style=color:#f92672>|</span>C:<span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#f92672>+----+</span>
</span></span></code></pre></div><h3 id=因果关系判断规则>因果关系判断规则<a href=#因果关系判断规则 class=hanchor arialabel=Anchor>&#8983;</a></h3><ol><li>如果时钟 V1 的每个逻辑时钟值都比时钟 V2 大，那么称 V1 比 V2 先发生。如： <code>V1: [A:2,B:4,C:2]</code> 与 <code>V2: [A:1,B:2,C:1]</code></li><li>如果不满足条件 1), 即有的值 V1 比 V2 大，有的 V2 比 V1 大，那么看做两个事件同时发生</li></ol><h2 id=应用>应用<a href=#应用 class=hanchor arialabel=Anchor>&#8983;</a></h2><p>向量时钟通常用于检测 replication 之间的数据冲突。例如 Dynamo: <a href=https://cloudacademy.com/blog/data-versioning-with-dynamodb-an-inside-look-into-nosql-part-5/>Data Versioning With DynamoDB</a>。</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>其他文章</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://when.run/cn/posts/python2-to-python3/><span class=button__icon>←</span>
<span class=button__text>Python2 迁移到 Python3 规划和实施</span>
</a></span><span class="button next"><a href=https://when.run/cn/posts/miao-sha/><span class=button__text>如何设计一个秒杀系统</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://utteranc.es/client.js repo=x1ah/x1ah.github.io issue-term=pathname label=Comment theme=photon-dark crossorigin=anonymous async></script></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://when.run/assets/main.js></script><script src=https://when.run/assets/prism.js></script></div></body></html>