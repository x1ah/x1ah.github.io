<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>x1ah</title>
    <link>https://when.run/</link>
    <description>Recent content on x1ah</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Tue, 16 Nov 2021 00:33:51 +0800</lastBuildDate><atom:link href="https://when.run/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>é¢è¯• Checklist</title>
      <link>https://when.run/posts/interview/</link>
      <pubDate>Tue, 16 Nov 2021 00:33:51 +0800</pubDate>
      
      <guid>https://when.run/posts/interview/</guid>
      <description></description>
      <content></content>
    </item>
    
    <item>
      <title>å¦‚ä½•å¹³ç¨³çš„å°† Elasticsearch 5.x é›†ç¾¤è¿ç§»åˆ° Elasticsearch 7.x</title>
      <link>https://when.run/posts/elasticsearch-upgrade/</link>
      <pubDate>Tue, 02 Mar 2021 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/elasticsearch-upgrade/</guid>
      <description>èƒŒæ™¯ å…¬å¸çš„å†…å®¹æœç´¢ä¸šåŠ¡ä¸»è¦åŸºäº Elasticsearch åšçš„ï¼Œè€é›†ç¾¤å·²ç»æœ‰äº”å…­å¹´çš„å†å²ï¼Œç‰ˆæœ¬åœç•™åœ¨äº† 5.6, é›†ç¾¤å†…çš„ document æ•°çº¦æœ‰ 20 äº¿çš„è§„æ¨¡ï¼Œç£ç›˜å ç”¨ä¸åˆ° 500 GBã€‚
éœ€è¦å‡çº§åˆ°æ–°ç‰ˆæœ¬ es çš„ä¸»è¦åŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š
 å‰æ®µæ—¶é—´å¶å‘æ€§çš„é›†ç¾¤æ•…éšœï¼Œå¯¼è‡´å´©æºƒï¼Œæ’æŸ¥å‘ç°ç–‘ä¼¼ç‰ˆæœ¬ bug Elasticsearch 7.x å¸¦æ¥äº†ä¸€ç³»åˆ—ä¼˜åŒ–ï¼ŒåŒ…æ‹¬æ€§èƒ½æœ‰ä¸å°çš„æå‡  å‡çº§æ–¹æ¡ˆè°ƒç ” Rolling upgrades  å®˜æ–¹æ–‡æ¡£ï¼šrolling upgrades
 ç”±äºæ—§é›†ç¾¤ç‰ˆæœ¬ä¸º 5.x ï¼Œéœ€è¦å‡çº§åˆ°çš„ç‰ˆæœ¬ä¸º 7.xï¼Œä¸­é—´æ¨ªè·¨ä¸¤ä¸ªå¤§ç‰ˆæœ¬ï¼Œæ ¹æ® elastic å®˜æ–¹å»ºè®®çš„å‡çº§ rolling upgrade æ­¥éª¤ï¼Œä¸­é—´éœ€è¦ä¸¤æ¬¡ rolling upgradeï¼Œåˆ†åˆ«ä¸ºï¼š
 From 5.x to 5.6 From 5.6 to 6.8 (rolling upgrade) From 6.8 to 7.x (rolling upgrade)  å‡çº§è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦ç»™é›†ç¾¤è®¾ç½®ä¸€å †é€‰é¡¹ï¼Œè¿™ä¸ªè¿‡ç¨‹çœ‹ä¼¼å¾ˆå¹³æ»‘ï¼Œè²Œä¼¼å¯ä»¥åšåˆ° graceful shutdownï¼Œä½†æ˜¯å®é™…æ˜¯ä¸å¯é€†çš„ï¼Œä¸­é—´ä»»ä½•ä¸€ä¸ªæ­¥éª¤å‡ºé”™éƒ½å¾ˆéš¾ç«‹é©¬æ¢å¤åˆ°å‡çº§å‰çš„çŠ¶æ€ã€‚æœç´¢æœåŠ¡éœ€è¦é«˜å¯ç”¨ï¼Œè€Œè¿™äº›æ“ä½œéƒ½æ˜¯ç›´æ¥å¯¹çº¿ä¸Šé›†ç¾¤è¿›è¡Œæ“ä½œï¼Œé£é™©æå¤§ï¼Œä¸€ä¸å°å¿ƒå¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤æ•…éšœã€‚å› æ­¤è¿™ä¸ªå‡çº§æ–¹æ¡ˆä¸å¯è¡Œã€‚
æ–°é›†ç¾¤ &amp;amp; æ–°ç´¢å¼• é™¤äº†å¯¹åŸé›†ç¾¤ rolling upgradeï¼Œè¿˜æœ‰ä¸€ç§ä¸‡æ— ä¸€å¤±çš„å‡çº§æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ç›´æ¥å¼€å¯ä¸€ä¸ª Elasticsearch 7.x ç‰ˆæœ¬çš„æ–°é›†ç¾¤ï¼Œé›†ç¾¤ ready ä¹‹åï¼Œå†æŠŠè€çš„ç´¢å¼•é‡å»ºåˆ°æ–°é›†ç¾¤ã€‚ä¸€åˆ‡å‡†å¤‡å¥½ä¹‹åï¼Œè¿˜å¯ä»¥è¿›è¡Œå‹æµ‹ï¼Œå¯¹æ¯”æ€§èƒ½ã€æ•°æ®å·®å¼‚ï¼Œå¹¶ä¸”å…¨ç¨‹ä¸å½±å“æœåŠ¡çš„å¯ç”¨æ€§ã€‚å…·ä½“å‡çº§æµç¨‹å¦‚ä¸‹ï¼š</description>
      <content>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;å…¬å¸çš„å†…å®¹æœç´¢ä¸šåŠ¡ä¸»è¦åŸºäº Elasticsearch åšçš„ï¼Œè€é›†ç¾¤å·²ç»æœ‰äº”å…­å¹´çš„å†å²ï¼Œç‰ˆæœ¬åœç•™åœ¨äº† 5.6, é›†ç¾¤å†…çš„ document æ•°çº¦æœ‰ 20 äº¿çš„è§„æ¨¡ï¼Œç£ç›˜å ç”¨ä¸åˆ° 500 GBã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦å‡çº§åˆ°æ–°ç‰ˆæœ¬ es çš„ä¸»è¦åŸå› æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‰æ®µæ—¶é—´å¶å‘æ€§çš„é›†ç¾¤æ•…éšœï¼Œå¯¼è‡´å´©æºƒï¼Œæ’æŸ¥å‘ç°ç–‘ä¼¼ç‰ˆæœ¬ bug&lt;/li&gt;
&lt;li&gt;Elasticsearch 7.x å¸¦æ¥äº†ä¸€ç³»åˆ—ä¼˜åŒ–ï¼ŒåŒ…æ‹¬æ€§èƒ½æœ‰ä¸å°çš„æå‡&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å‡çº§æ–¹æ¡ˆè°ƒç ”&#34;&gt;å‡çº§æ–¹æ¡ˆè°ƒç ”&lt;/h2&gt;
&lt;h4 id=&#34;rolling-upgrades&#34;&gt;Rolling upgrades&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/rolling-upgrades.html&#34;&gt;rolling upgrades&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç”±äºæ—§é›†ç¾¤ç‰ˆæœ¬ä¸º 5.x ï¼Œéœ€è¦å‡çº§åˆ°çš„ç‰ˆæœ¬ä¸º 7.xï¼Œä¸­é—´æ¨ªè·¨ä¸¤ä¸ªå¤§ç‰ˆæœ¬ï¼Œæ ¹æ® elastic å®˜æ–¹å»ºè®®çš„å‡çº§ &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/rolling-upgrades.html&#34;&gt;rolling upgrade&lt;/a&gt; æ­¥éª¤ï¼Œä¸­é—´éœ€è¦ä¸¤æ¬¡ rolling upgradeï¼Œåˆ†åˆ«ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;From 5.x to 5.6&lt;/li&gt;
&lt;li&gt;From 5.6 to 6.8 (&lt;strong&gt;rolling upgrade&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;From 6.8 to 7.x (&lt;strong&gt;rolling upgrade&lt;/strong&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‡çº§è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦ç»™é›†ç¾¤è®¾ç½®ä¸€å †é€‰é¡¹ï¼Œè¿™ä¸ªè¿‡ç¨‹çœ‹ä¼¼å¾ˆå¹³æ»‘ï¼Œè²Œä¼¼å¯ä»¥åšåˆ° graceful shutdownï¼Œä½†æ˜¯å®é™…æ˜¯ä¸å¯é€†çš„ï¼Œä¸­é—´ä»»ä½•ä¸€ä¸ªæ­¥éª¤å‡ºé”™éƒ½å¾ˆéš¾ç«‹é©¬æ¢å¤åˆ°å‡çº§å‰çš„çŠ¶æ€ã€‚æœç´¢æœåŠ¡éœ€è¦é«˜å¯ç”¨ï¼Œè€Œè¿™äº›æ“ä½œéƒ½æ˜¯ç›´æ¥å¯¹çº¿ä¸Šé›†ç¾¤è¿›è¡Œæ“ä½œï¼Œé£é™©æå¤§ï¼Œä¸€ä¸å°å¿ƒå¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤æ•…éšœã€‚å› æ­¤è¿™ä¸ªå‡çº§æ–¹æ¡ˆä¸å¯è¡Œã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ–°é›†ç¾¤--æ–°ç´¢å¼•&#34;&gt;æ–°é›†ç¾¤ &amp;amp; æ–°ç´¢å¼•&lt;/h4&gt;
&lt;p&gt;é™¤äº†å¯¹åŸé›†ç¾¤ rolling upgradeï¼Œè¿˜æœ‰ä¸€ç§ä¸‡æ— ä¸€å¤±çš„å‡çº§æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ç›´æ¥å¼€å¯ä¸€ä¸ª Elasticsearch 7.x ç‰ˆæœ¬çš„æ–°é›†ç¾¤ï¼Œé›†ç¾¤ ready ä¹‹åï¼Œå†æŠŠè€çš„ç´¢å¼•é‡å»ºåˆ°æ–°é›†ç¾¤ã€‚ä¸€åˆ‡å‡†å¤‡å¥½ä¹‹åï¼Œè¿˜å¯ä»¥è¿›è¡Œå‹æµ‹ï¼Œå¯¹æ¯”æ€§èƒ½ã€æ•°æ®å·®å¼‚ï¼Œå¹¶ä¸”å…¨ç¨‹ä¸å½±å“æœåŠ¡çš„å¯ç”¨æ€§ã€‚å…·ä½“å‡çº§æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ­å»ºæ–°é›†ç¾¤ï¼Œå°½é‡ä¿æŒé…ç½®ä¸è€é›†ç¾¤ä¸€è‡´ã€‚æ¯”å¦‚å¦‚æœæœ‰ ik æ’ä»¶ï¼Œé‚£ä¹ˆéœ€è¦ä¿è¯ ik çš„è¯å…¸æ–‡ä»¶ä¸è€é›†ç¾¤ä¸€è‡´&lt;/li&gt;
&lt;li&gt;æ–°å»ºç´¢å¼•ã€‚è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯æ–¹ä¾¿åé¢çš„ç´¢å¼•èƒ½å¤ŸåŒæ­¥åŒå†™åˆ°æ–°è€ä¸¤ä¸ªé›†ç¾¤ã€‚åŒæ—¶å»ºç´¢å¼•æ—¶éœ€è¦æ³¨æ„ï¼Œes7 å·²ç»åºŸå¼ƒäº† mapping é‡Œçš„ document typeï¼Œmapping ä¸å†éœ€è¦æŒ‡å®š type äº†&lt;/li&gt;
&lt;li&gt;ç´¢å¼•åŒå†™ã€‚ç¬¬äºŒæ­¥å·²ç»å°†ç´¢å¼•åœ¨æ–°é›†ç¾¤ä¸­å»ºå¥½äº†ï¼Œè¿™é‡Œåœ¨ä¸šåŠ¡ä»£ç ä¸­å¼€å§‹åŒå†™ï¼Œä¿è¯æ–°å¢çš„ document èƒ½å¤Ÿä¸è€é›†ç¾¤çš„ç´¢å¼•ä¸€è‡´&lt;/li&gt;
&lt;li&gt;å…¨é‡ç´¢å¼•ã€‚æ–°å¢ç´¢å¼•ä¸€è‡´åï¼Œå­˜é‡çš„ document ä¹Ÿéœ€è¦ä¸€è‡´ï¼Œå› æ­¤éœ€è¦æŠŠå­˜é‡çš„ doc é‡æ–°å…¨éƒ¨å¯¼å…¥åˆ°æ–°é›†ç¾¤å†…ã€‚è¿™ä¸€æ­¥å®˜æ–¹æä¾›äº†ä¸€ä¸ª &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-reindex.html#reindex-from-remote&#34;&gt;reindex from remote&lt;/a&gt;ï¼Œä½†æ˜¯å®é™…æ“ä½œåå‘ç°ï¼Œreindex åï¼Œmapping å’Œ settings ä¼šæœ‰å‡ºå…¥ï¼Œå¹¶ä¸”ä¸ç¡®å®šè¿™ä¸ªæ“ä½œå¯¹è€é›†ç¾¤çš„å‹åŠ›å¤§ä¸å¤§ï¼Œå› æ­¤è¿˜æ˜¯å†³å®šè·‘ä¸‹è„šæœ¬äººå·¥é‡å»º&lt;/li&gt;
&lt;li&gt;çº¿ä¸Šæµ‹è¯•ï¼ŒåŒ…æ‹¬æ€§èƒ½æµ‹è¯•ã€ç¨³å®šæ€§è§‚å¯Ÿã€æ•°æ®æ¯”å¯¹ç­‰&lt;/li&gt;
&lt;li&gt;åœæ‰ç´¢å¼•åŒå†™&lt;/li&gt;
&lt;li&gt;ä¸‹çº¿è€é›†ç¾¤ï¼Œå…¨é¢è¦†ç›–æ–°é›†ç¾¤&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æµ‹è¯•æ–°é›†ç¾¤&#34;&gt;æµ‹è¯•æ–°é›†ç¾¤&lt;/h2&gt;
&lt;p&gt;æ–°é›†ç¾¤å‡†å¤‡å¥½ä¹‹åï¼Œéœ€è¦è¿›è¡Œä¸€äº›å¿…è¦çš„æµ‹è¯•ï¼Œæ¯”å¦‚ï¼šæ€§èƒ½æµ‹è¯•ã€æ•°æ®æ¯”å¯¹ã€è€çš„æŸ¥è¯¢è¯­å¥å…¼å®¹æ€§æµ‹è¯•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ€§èƒ½æµ‹è¯•&#34;&gt;æ€§èƒ½æµ‹è¯•&lt;/h4&gt;
&lt;p&gt;æ€§èƒ½æµ‹è¯•å¯ä»¥æŒ‘æ‹£ä¸€ä¸ªä¸šåŠ¡ä»£ç é‡Œæœ€å¸¸ç”¨çš„æŸ¥è¯¢è¯­å¥ï¼Œç„¶åè¿›è¡Œå‹æµ‹ã€‚æ¯”å¦‚æˆ‘è¿™é‡Œä½¿ç”¨ wrk å‹æµ‹ä¸€ä¸ªæœ€ç®€å•çš„å…¨æ–‡æœç´¢&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// dsl.lua æ–‡ä»¶å†…å®¹

wrk.method = &amp;quot;GET&amp;quot;
wrk.body = [[{
    &amp;quot;query&amp;quot;:{
        &amp;quot;match&amp;quot;:{
            &amp;quot;name&amp;quot;:{
                &amp;quot;query&amp;quot;:&amp;quot;çƒ˜ç„™&amp;quot;
            }
        }
    },
    &amp;quot;size&amp;quot;:100
}]]
wrk.headers[&amp;quot;Content-Type&amp;quot;] = &amp;quot;application/json&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å‹æµ‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wrk -t10 -c10 -d10s --script=dsl.lua http://elasticsearch-address:9200/you_index/_search
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç»“æœç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Running 10s test @ http://elasticsearch-address:9200/you_index/_search
  10 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     8.31ms    2.12ms  35.71ms   75.93%
    Req/Sec   121.09     12.97   151.00     78.10%
  12068 requests in 10.01s, 3.80GB read
Requests/sec:   1205.70
Transfer/sec:    388.64MB
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥é€‚å½“è°ƒæ•´å‹æµ‹å‚æ•°ï¼Œä»¥åŠæŸ¥è¯¢è¯­å¥ï¼Œé€šè¿‡æ¯”å¯¹ wrk è¾“å‡ºçš„ Avg latency å¾—å‡ºæ€§èƒ½å·®å¼‚çš„ç»“è®ºã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ•°æ®æ¯”å¯¹&#34;&gt;æ•°æ®æ¯”å¯¹&lt;/h4&gt;
&lt;p&gt;ä¸æ€§èƒ½å‹æµ‹ç±»ä¼¼ï¼Œæ‰¾ä¸€äº›ä¸šåŠ¡å¸¸ç”¨çš„æŸ¥è¯¢è¯­å¥ï¼Œåˆ†åˆ«å¯¹ä¸¤ä¸ªé›†ç¾¤æŸ¥è¯¢ç»“æœé‡‡æ ·ï¼Œæ¯”å¯¹æœå‡ºæ¥çš„ç»“æœæ˜¯å¦æœ‰å·®å¼‚ï¼Œä¾æ¬¡åˆ¤æ–­ç´¢å¼•æ˜¯å¦æœ‰å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¸šåŠ¡æ•°æ®æµ‹è¯•çš„åŒæ—¶ï¼Œè¿˜éœ€è¦æµ‹è¯•æ’ä»¶åŠ è½½æ˜¯å¦ä¸è€é›†ç¾¤ä¸€è‡´ï¼Œæ¯”å¦‚ ik çš„è¯å…¸æ–‡ä»¶æ˜¯å¦æ­£å¸¸åŠ è½½ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-analyze.html&#34;&gt;&lt;code&gt;/index/_analyze&lt;/code&gt;&lt;/a&gt; æ¥å£æ¥è¿›è¡Œæµ‹è¯•ï¼Œå¹¶æ¯”å¯¹ç»“æœæ˜¯å¦ä¸€è‡´&lt;/p&gt;
&lt;h4 id=&#34;è¯¡å¼‚çš„æ¯›åˆº&#34;&gt;è¯¡å¼‚çš„æ¯›åˆº&lt;/h4&gt;
&lt;p&gt;åœ¨å°†ç´¢å¼•è¿ç§»åˆ°æ–°é›†ç¾¤åï¼Œæ€§èƒ½ç›‘æ§å‘ç°ï¼Œ æœç´¢è¯·æ±‚ç»å¸¸æ€§çš„å‡ºç°æ¯›åˆºï¼Œè€Œä¸”çœ‹èµ·æ¥æ˜¯æœ‰è§„å¾‹çš„æ¯›åˆºï¼Œå¦‚æœ 30s å†…æ²¡æœ‰ search è¯·æ±‚ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å¿…ç„¶ä¼šå‡ºç°ä¸€æ ¹æ¯›åˆº
&lt;img src=&#34;https://when.run/image/es_latency.png&#34; alt=&#34;es-latency&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜å›°æ‰°äº†å¾ˆä¹…ï¼Œæ’æŸ¥æ€è·¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆæŸ¥çœ‹æ˜¯å¦ä¸º SDK çš„é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯å®¢æˆ·ç«¯åˆ° es server çš„é•¿è¿æ¥æ–­äº†ï¼Œå¯¼è‡´ 30s åéœ€è¦é‡æ–°å»ºç«‹é•¿è¿æ¥ï¼Œè°ƒé•¿é“¾æ¥æ—¶é—´åå‘ç°å¹¶æœªæ”¹å–„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¥ä¸‹æ¥çœ‹ç´¢å¼•çš„ &lt;code&gt;_stats&lt;/code&gt; ä¿¡æ¯ï¼Œå‘ç° &lt;code&gt;docs.deleted&lt;/code&gt; ç‰¹åˆ«å¤šã€‚äº§ç”Ÿè¿™ä¹ˆå¤š deleted çš„åŸå› å¯ä»¥è§£é‡Šï¼Œå› ä¸ºä¸€ä¸ª update æ“ä½œç­‰äºä¸€ä¸ª create + ä¸€ä¸ª deleteï¼Œåˆ›å»ºæ–° docï¼Œæ ‡è®°è€ doc ä¸º deletedã€‚ä½†æ˜¯åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œmerge ä¼šæŠŠè€çš„ segment ç»™åˆå¹¶æ‰ï¼Œdeleted çš„ doc ä¹Ÿä¸€å¹¶è¢«æ¸…ç†äº†ï¼Œä½†æ˜¯è¿™ä¸ªæŒ‡æ ‡å´æ²¡æœ‰è§å˜å°‘ï¼Œä¸€ç›´åœ¨å¢åŠ ï¼Œæ­¤æ—¶æ€€ç–‘æ˜¯ merge æµç¨‹çš„é—®é¢˜ã€‚æ˜¯å¦ merge æœªæ­£å¸¸å·¥ä½œã€‚
&lt;img src=&#34;https://when.run/image/docs_deleted.png&#34; alt=&#34;docs.deleted&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»§ç»­çœ‹ç´¢å¼•çš„ &lt;code&gt;_stats&lt;/code&gt; ä¿¡æ¯ï¼Œå‘ç° &lt;code&gt;refresh&lt;/code&gt; æ•°éå¸¸å¥‡æ€ªï¼Œé»˜è®¤ &lt;code&gt;refresh_interval&lt;/code&gt; æ˜¯ 1sï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸æƒ…å†µä¸‹æ˜¯æ¯ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œrefresh.total ä¹Ÿå°±æ˜¯ç´¢å¼•åˆ›å»ºåˆ°å½“å‰æ—¶é—´çš„ç§’æ•°ï¼Œè€Œå‡ å¤©å‰åˆ›å»ºçš„ç´¢å¼•ï¼Œç°åœ¨å´åª refresh äº†800+æ¬¡ï¼Œé‚£ä¹ˆæ˜¯å¦è·Ÿè¿™ä¸ªæ²¡æœ‰ refresh æœ‰å…³ç³»å‘¢ï¼Ÿä¸ºäº†éªŒè¯è¿™ä¸ªé—®é¢˜ï¼Œæ‰‹åŠ¨è·‘ä¸ªè„šæœ¬ï¼Œåœ¨åå°ä¸é—´æ–­çš„å‘é€ search è¯·æ±‚ï¼Œå‘ç°å¼€å§‹ refresh äº†ï¼Œæ¯›åˆºä¹Ÿæ¶ˆå¤±äº†ï¼Œè¯´æ˜é—®é¢˜å‡ºåœ¨äº† refresh ä¸Šé¢ï¼Œå‡ºäºæŸäº›åŸå› æ²¡æœ‰æ­£å¸¸çš„æ‰§è¡Œ refresh
&lt;img src=&#34;https://when.run/image/refresh_total.png&#34; alt=&#34;refresh.total&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ä¸€ç•ªæŸ¥æ‰¾ä¹‹åï¼Œåœ¨ &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-refresh-interval-setting&#34;&gt;es æ–‡æ¡£&lt;/a&gt; çš„ &lt;code&gt;refresh_interval&lt;/code&gt; å­—æ®µè§£é‡Šé‡Œå‘ç°è¿™ä¹ˆä¸€å¥è¯ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®š &lt;code&gt;refresh_interval&lt;/code&gt;ï¼Œé‚£ä¹ˆå¦‚æœ 30s å†…æ²¡æœ‰ search è¯·æ±‚æ¥ï¼Œä¼šè·³è¿‡ refresh æ­¥éª¤ï¼Œç›´åˆ°æœ‰ search è¯·æ±‚æ¥æ—¶ï¼Œæ‰ä¼šè§¦å‘ refreshï¼Œå¹¶ç­‰ refresh å®Œä¹‹åæ‰å¼€å§‹å¤„ç† search è¯·æ±‚ã€‚è¿™ä¹Ÿå°±èƒ½è§£é‡Šä¸ºä»€ä¹ˆ 30s æ²¡æœ‰æœç´¢æµé‡å°±ä¼šå‡ºç°ä¸€æ ¹æ¯›åˆºäº†ã€‚å½“æ‰‹åŠ¨ç»™ç´¢å¼•æŒ‡å®š &lt;code&gt;refresh_interval&lt;/code&gt; ä¹‹åï¼Œé»˜è®¤è¡Œä¸ºå°±å˜å¾—å’Œè€ç‰ˆæœ¬ä¸€æ ·ï¼Œä¸å†è·³è¿‡ refreshï¼Œæ¯›åˆºä¹Ÿå°±æ¶ˆå¤±äº†ã€‚åœ¨ elasticsearch 7.0 çš„ &lt;a href=&#34;https://www.elastic.co/cn/blog/elasticsearch-7-0-0-released&#34;&gt;release note&lt;/a&gt; é‡Œä¹Ÿæåˆ°äº†ï¼š
&lt;img src=&#34;https://when.run/image/refresh_interval_doc.png&#34; alt=&#34;refresh.doc&#34;&gt;
&lt;img src=&#34;https://when.run/image/es7_release.png&#34; alt=&#34;release&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;å…¼å®¹æ€§æµ‹è¯•&#34;&gt;å…¼å®¹æ€§æµ‹è¯•&lt;/h4&gt;
&lt;p&gt;ç”±äºä¸¤ä¸ªé›†ç¾¤ç‰ˆæœ¬è·¨åº¦æ¯”è¾ƒå¤§ï¼Œå®¹æ˜“å‡ºä¹Œé¾™ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ª DSLï¼Œåœ¨ es 5.x å’Œ es7.x ä¸¤ä¸ªç‰ˆæœ¬çš„æœç´¢ç»“æœè¿¥ç„¶ä¸åŒã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;{
  &amp;quot;query&amp;quot;: {
    &amp;quot;bool&amp;quot; : {
      &amp;quot;should&amp;quot; : [
        { &amp;quot;term&amp;quot; : { &amp;quot;tags&amp;quot; : &amp;quot;env1&amp;quot; } },
        { &amp;quot;term&amp;quot; : { &amp;quot;tags&amp;quot; : &amp;quot;deployed&amp;quot; } }
      ]
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åŸå› ä¸ºï¼šes5 bool query åªæœ‰ should æ¡ä»¶æ—¶ï¼Œé»˜è®¤ &lt;code&gt;minimum_should_match = 1&lt;/code&gt;ï¼Œè€Œåˆ°äº† es7 é‡Œï¼Œé»˜è®¤å€¼ä¸º 0 äº†ï¼Œå¯¼è‡´ es7 é‡Œæœå‡ºæ¥çš„æ˜¯å…¨éƒ¨ docï¼Œè€Œ es5 åªä¼šæœå‡ºç¬¦åˆæ¡ä»¶çš„ç»“æœ(&lt;a href=&#34;https://stackoverflow.com/questions/48984706/default-value-of-minimum-should-match/49012705#49012705&#34;&gt;default value of minimum should match&lt;/a&gt;ã€‚å¯¹äºè¿™äº›å·®å¼‚ï¼Œå¯ä»¥äº‹å…ˆé˜…è¯» &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking-changes-7.0.html&#34;&gt;breaking changes 7.0&lt;/a&gt;ï¼Œå¹¶è¿›è¡Œç›¸åº”ä¿®æ”¹ã€‚å¯¹äºæœ‰ä¸å…¼å®¹æˆ–è€…æœ‰å·®å¼‚çš„è¯­å¥ï¼Œåœ¨ &lt;em&gt;æ•°æ®æ¯”å¯¹&lt;/em&gt; æ­¥éª¤ä¹Ÿèƒ½å¤Ÿæµ‹å‡ºæ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;
&lt;p&gt;åœ¨æµ‹è¯•é€šè¿‡ä¹‹åï¼Œå°±å¯ä»¥ä¸‹çº¿è€é›†ç¾¤ï¼Œå…¨é¢åˆ‡æ¢åˆ°æ–°é›†ç¾¤äº†ğŸ‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæœ‰å‡ ä¸ªè¸©è¿‡çš„å‘éœ€è¦æ³¨æ„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;es 7 å·²ç»åºŸå¼ƒäº† mapping type: &lt;a href=&#34;https://www.elastic.co/guide/en/elasticsearch/reference/current/removal-of-types.html&#34;&gt;Removal of mapping types&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åˆ‡è¯æ’ä»¶(ik) ç»“æœæ¯”å¯¹ï¼Œä¿è¯æ’ä»¶åŠ è½½æ­£å¸¸&lt;/li&gt;
&lt;li&gt;å…³æ³¨æ–°ç‰ˆæœ¬çš„ä¸€äº›é»˜è®¤å€¼æ”¹åŠ¨ï¼Œä¸€äº› breaking changes&lt;/li&gt;
&lt;/ul&gt;
</content>
    </item>
    
    <item>
      <title>Elasticsearch terminology: Index &amp; Shard &amp; Segment</title>
      <link>https://when.run/posts/es-terminology/</link>
      <pubDate>Wed, 04 Nov 2020 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/es-terminology/</guid>
      <description>References from https://stackoverflow.com/a/15429578
To explain:
Index An &amp;ldquo;index&amp;rdquo; in Elasticsearch is a bit like a database in a relational DB. It&amp;rsquo;s where you store/index your data. But actually, that&amp;rsquo;s just what your application sees. Internally, an index is a logical namespace that points to one or more shards.
Also, &amp;ldquo;to index&amp;rdquo; means to &amp;ldquo;put&amp;rdquo; your data into Elasticsearch. Your data is both stored (for retrieval) and &amp;ldquo;indexed&amp;rdquo; for search.
Inverted Index An &amp;ldquo;inverted index&amp;rdquo; is the data structure that Lucene uses to make data searchable.</description>
      <content>&lt;p&gt;&lt;em&gt;&lt;strong&gt;References from &lt;a href=&#34;https://stackoverflow.com/a/15429578&#34;&gt;https://stackoverflow.com/a/15429578&lt;/a&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;To explain:&lt;/p&gt;
&lt;h2 id=&#34;index&#34;&gt;Index&lt;/h2&gt;
&lt;p&gt;An &amp;ldquo;index&amp;rdquo; in Elasticsearch is a bit like a database in a relational DB. It&amp;rsquo;s where you store/index your data. But actually, that&amp;rsquo;s just what your application sees. Internally, an index is a logical namespace that points to one or more shards.&lt;/p&gt;
&lt;p&gt;Also, &amp;ldquo;to index&amp;rdquo; means to &amp;ldquo;put&amp;rdquo; your data into Elasticsearch. Your data is both stored (for retrieval) and &amp;ldquo;indexed&amp;rdquo; for search.&lt;/p&gt;
&lt;h2 id=&#34;inverted-index&#34;&gt;Inverted Index&lt;/h2&gt;
&lt;p&gt;An &amp;ldquo;inverted index&amp;rdquo; is the data structure that Lucene uses to make data searchable. It processes the data, pulls out unique terms or tokens, then records which documents contain those tokens. See &lt;a href=&#34;http://en.wikipedia.org/wiki/Inverted_index&#34;&gt;http://en.wikipedia.org/wiki/Inverted_index&lt;/a&gt; for more.&lt;/p&gt;
&lt;h2 id=&#34;shard&#34;&gt;Shard&lt;/h2&gt;
&lt;p&gt;A &amp;ldquo;shard&amp;rdquo; is an instance of Lucene. It is a fully functional search engine in its own right. An &amp;ldquo;index&amp;rdquo; could consist of a single shard, but generally consists of several shards, to allow the index to grow and to be split over several machines.&lt;/p&gt;
&lt;p&gt;A &amp;ldquo;primary shard&amp;rdquo; is the main home for a document. A &amp;ldquo;replica shard&amp;rdquo; is a copy of the primary shard that provides (1) failover in case the primary dies and (2) increased read throughput&lt;/p&gt;
&lt;h2 id=&#34;segment&#34;&gt;Segment&lt;/h2&gt;
&lt;p&gt;Each shard contains multiple &amp;ldquo;segments&amp;rdquo;, where a segment is an inverted index. A search in a shard will search each segment in turn, then combine their results into the final results for that shard.&lt;/p&gt;
&lt;p&gt;While you are indexing documents, Elasticsearch collects them in memory (and in the transaction log, for safety) then every second or so, writes a new small segment to disk, and &amp;ldquo;refreshes&amp;rdquo; the search.&lt;/p&gt;
&lt;p&gt;This makes the data in the new segment visible to search (ie they are &amp;ldquo;searchable&amp;rdquo;), but the segment has not been fsync&amp;rsquo;ed to disk, so is still at risk of data loss.&lt;/p&gt;
&lt;p&gt;Every so often, Elasticsearch will &amp;ldquo;flush&amp;rdquo;, which means fsync&amp;rsquo;ing the segments, (they are now &amp;ldquo;committed&amp;rdquo;) and clearing out the transaction log, which is no longer needed because we know that the new data has been written to disk.&lt;/p&gt;
&lt;p&gt;The more segments there are, the longer each search takes. So Elasticsearch will merge a number of segments of a similar size (&amp;ldquo;tier&amp;rdquo;) into a single bigger segment, through a background merge process. Once the new bigger segment is written, the old segments are dropped. This process is repeated on the bigger segments when there are too many of the same size.&lt;/p&gt;
&lt;p&gt;Segments are immutable. When a document is updated, it actually just marks the old document as deleted, and indexes a new document. The merge process also expunges these old deleted documents.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;References from &lt;a href=&#34;https://stackoverflow.com/a/15429578&#34;&gt;https://stackoverflow.com/a/15429578&lt;/a&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>é•¿è¿æ¥èŠå¤©å®¤ Demo</title>
      <link>https://when.run/posts/keep-alive-chat/</link>
      <pubDate>Tue, 03 Nov 2020 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/keep-alive-chat/</guid>
      <description>Server package main import ( &amp;#34;bufio&amp;#34; &amp;#34;fmt&amp;#34; &amp;#34;net&amp;#34; ) // ç”¨æ¥è®°å½•æ‰€æœ‰çš„å®¢æˆ·ç«¯è¿æ¥ var ConnMap map[string]*net.TCPConn func main() { var tcpAddr *net.TCPAddr ConnMap = make(map[string]*net.TCPConn) tcpAddr, _ = net.ResolveTCPAddr(&amp;#34;tcp&amp;#34;, &amp;#34;127.0.0.1:9999&amp;#34;) tcpListener, _ := net.ListenTCP(&amp;#34;tcp&amp;#34;, tcpAddr) defer tcpListener.Close() for { tcpConn, err := tcpListener.AcceptTCP() if err != nil { continue } fmt.Println(&amp;#34;A client connected : &amp;#34; + tcpConn.RemoteAddr().String()) // æ–°è¿æ¥åŠ å…¥map  ConnMap[tcpConn.RemoteAddr().String()] = tcpConn go tcpPipe(tcpConn) } } func tcpPipe(conn *net.TCPConn) { ipStr := conn.</description>
      <content>&lt;h4 id=&#34;server&#34;&gt;Server&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;

&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#75715e&#34;&gt;// ç”¨æ¥è®°å½•æ‰€æœ‰çš„å®¢æˆ·ç«¯è¿æ¥
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ConnMap&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TCPConn&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpAddr&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TCPAddr&lt;/span&gt;
    &lt;span style=&#34;color:#a6e22e&#34;&gt;ConnMap&lt;/span&gt; = make(&lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TCPConn&lt;/span&gt;)
    &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpAddr&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResolveTCPAddr&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:9999&amp;#34;&lt;/span&gt;)

    &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpListener&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenTCP&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpAddr&lt;/span&gt;)

    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpListener&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()

    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
        &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpConn&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpListener&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;AcceptTCP&lt;/span&gt;()
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
            &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;
        }

        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;A client connected : &amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpConn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RemoteAddr&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;String&lt;/span&gt;())
        &lt;span style=&#34;color:#75715e&#34;&gt;// æ–°è¿æ¥åŠ å…¥map
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;ConnMap&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;tcpConn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RemoteAddr&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;String&lt;/span&gt;()] = &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpConn&lt;/span&gt;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpPipe&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;tcpConn&lt;/span&gt;)
    }

}

&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpPipe&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TCPConn&lt;/span&gt;) {
    &lt;span style=&#34;color:#a6e22e&#34;&gt;ipStr&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RemoteAddr&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;String&lt;/span&gt;()
    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;() {
        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;disconnected :&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ipStr&lt;/span&gt;)
        &lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
    }()
    &lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bufio&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewReader&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;)

    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
        &lt;span style=&#34;color:#a6e22e&#34;&gt;message&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadString&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
            &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
        }
        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RemoteAddr&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;String&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; string(&lt;span style=&#34;color:#a6e22e&#34;&gt;message&lt;/span&gt;))
        &lt;span style=&#34;color:#75715e&#34;&gt;// è¿™é‡Œè¿”å›æ¶ˆæ¯æ”¹ä¸ºäº†å¹¿æ’­
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;boradcastMessage&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RemoteAddr&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;String&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; string(&lt;span style=&#34;color:#a6e22e&#34;&gt;message&lt;/span&gt;))
    }
}


&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;boradcastMessage&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;message&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;) {
    &lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; []byte(&lt;span style=&#34;color:#a6e22e&#34;&gt;message&lt;/span&gt;)
    &lt;span style=&#34;color:#75715e&#34;&gt;// éå†æ‰€æœ‰å®¢æˆ·ç«¯å¹¶å‘é€æ¶ˆæ¯
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ConnMap&lt;/span&gt; {
        &lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Write&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt;)
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;client&#34;&gt;Client&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;

&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpAddr&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TCPAddr&lt;/span&gt;
    &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpAddr&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResolveTCPAddr&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:9999&amp;#34;&lt;/span&gt;)

    &lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;DialTCP&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;tcp&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;tcpAddr&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
    &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;connected!&amp;#34;&lt;/span&gt;)

    &lt;span style=&#34;color:#66d9ef&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onMessageRecived&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;)

    &lt;span style=&#34;color:#75715e&#34;&gt;// æ§åˆ¶å°èŠå¤©åŠŸèƒ½åŠ å…¥
&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
        &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Scanln&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;quit&amp;#34;&lt;/span&gt; {
            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
        }
        &lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; []byte(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;)
        &lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Write&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt;)
    }
}

&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;onMessageRecived&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;net&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TCPConn&lt;/span&gt;) {
    &lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;bufio&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewReader&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;conn&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
        &lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadString&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;)
        &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;msg&lt;/span&gt;)
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
            &lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;run&#34;&gt;Run&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&amp;gt; go run server.go
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&amp;gt; go run client.go
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content>
    </item>
    
    <item>
      <title>TCP æœ­è®°</title>
      <link>https://when.run/posts/tcp/</link>
      <pubDate>Mon, 10 Feb 2020 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/tcp/</guid>
      <description>TCP å¤„äºä¸ƒå±‚ç½‘ç»œæ¨¡å‹ï¼ˆåº”è¡¨ä¼šä¼ ç½‘æ•°ç‰©ï¼‰ä¸­çš„ä¼ è¾“å±‚ã€‚
 ç‰¹ç‚¹ é¢å‘è¿æ¥ å’Œ UDP ä¸ä¸€æ ·ï¼ŒTCP ä¼ è¾“æ•°æ®å‰éœ€è¦å…ˆå»ºç«‹ TCP è¿æ¥ï¼ˆæ­¤å¤„å¼•å‡ºä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ï¼‰ã€‚è€Œ UDP ä¼ è¾“æ•°æ®å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œä¹Ÿä¸ä¿è¯å¯é ä¼ è¾“ã€‚
å¯é ä¼ è¾“ TCP ä¿è¯ä¼ è¾“çš„æ•°æ®ï¼šæ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€ æŒ‰åºåˆ°è¾¾ ã€‚
å…¨åŒå·¥ é€šä¿¡åŒæ–¹ä»»ä½•æ—¶å€™éƒ½èƒ½ç›¸äº’é€šä¿¡ã€‚å¹¶ä¸”éƒ½æœ‰å‘é€ç¼“å­˜ã€æ¥å—ç¼“å­˜ã€‚
é¢å‘å­—èŠ‚æµ è™½ç„¶åº”ç”¨å±‚å’Œ TCP çš„äº¤äº’æ˜¯ä¸€æ¬¡ä¸€ä¸ªæ•°æ®å—ï¼ˆå¤§å°ä¸ç­‰ï¼‰ï¼Œä½†æ˜¯ TCP æŠŠè¿™äº›æ•°æ®çœ‹æˆä»…ä»…æ˜¯ä¸€è¿ä¸²çš„æ— ç»“æ„å­—èŠ‚æµã€‚TCP å¹¶ä¸çŸ¥é“æ‰€ä¼ é€çš„å­—èŠ‚æµçš„å«ä¹‰ã€‚ä¼ è¾“è¿‡ç¨‹å¦‚ä¸‹ï¼š
è¿™é‡Œçœ‹åˆ°ï¼Œåº”ç”¨å±‚å‘é€å…¶å®ä¸æ˜¯åŒæ­¥å‘é€çš„ï¼Œè€Œåªæ˜¯æŠŠæ•°æ®æ‹·åˆ° TCP å‘é€ç¼“å­˜é‡Œï¼Œè€Œä¸‹ä¸€æ­¥å¦‚ä½•å‘é€ï¼Œå¦‚ä½•æŠŠæ•°æ®åˆ‡æˆæŠ¥æ–‡æ®µï¼Œéƒ½ä¸åº”ç”¨å±‚æ— å…³äº†ã€‚
åŸºäºè¿™ä¸ªå­—èŠ‚æµä¼ è¾“æ¦‚å¿µï¼Œå¯¹äºå¶å°”èƒ½å¬åˆ°çš„ â€œé»åŒ…â€ æ¦‚å¿µä¹Ÿèƒ½è¾ƒä¸ºç›´æ¥çš„è§£é‡Šã€‚å› ä¸º TCP å¹¶æ²¡æœ‰åŒ…çš„æ¦‚å¿µï¼Œå› æ­¤è‡ªç„¶ä¹Ÿå°±ä¸å­˜åœ¨ â€œé»åŒ…â€ ä¸ºä»€ä¹ˆ TCP åè®®æœ‰ç²˜åŒ…é—®é¢˜ã€‚&amp;ldquo;é»åŒ…&amp;rdquo; è¯¯è§£çš„åŸå› æ˜¯ï¼š&amp;ldquo;åº”ç”¨å±‚åè®®æ²¡æœ‰ä½¿ç”¨åŸºäºé•¿åº¦æˆ–è€…åŸºäºç»ˆç»“ç¬¦çš„æ¶ˆæ¯è¾¹ç•Œï¼Œå¯¼è‡´å¤šä¸ªæ¶ˆæ¯çš„ç²˜è¿&amp;rdquo;
æŠ¥æ–‡æ®µã€å­—èŠ‚æµ TCP å­˜åœ¨ä¸€ä¸ª â€œæŠ¥æ–‡æ®µâ€ çš„æ¦‚å¿µï¼Œè¿™ä¸ªæŒ‡çš„æ˜¯ï¼šåœ¨ TCP æ¥æ”¶åˆ°åº”ç”¨å±‚å†™å…¥çš„æ•°æ®ä¹‹åï¼Œä¼šæš‚å­˜åˆ°å‘é€ç¼“å­˜ã€‚è€Œ TCP åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œä¼šä»å‘é€ç¼“å­˜ä¸­å–å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¹¶ä¸”åŠ ä¸Š TCP å±‚çš„ç‰¹å®šå¤´éƒ¨æ•°æ®ï¼Œå†å¾€ä¸‹ä¼ è¾“ç»™ IP å±‚ï¼ŒåŠ ä¸Šäº† TCP å¤´éƒ¨çš„è¿™éƒ¨åˆ†æ•°æ®ï¼Œå«åš TCP çš„ â€œæŠ¥æ–‡æ®µâ€ï¼Œè¿™ä¸ªæŠ¥æ–‡æ®µçš„æœ€å¤§é•¿åº¦å«åš MSSï¼ˆæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼‰ã€‚è€Œåœ¨ä¼ è¾“æ—¶ï¼ŒæŠ¥æ–‡æ®µä¼šè¢«ä»¥å­—èŠ‚æµçš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°å­—èŠ‚æµä¹‹åï¼Œå†è§£æå­—èŠ‚æµè¿˜åŸæˆæŠ¥æ–‡æ®µï¼Œäº¤ä»˜ä½¿ç”¨ã€‚
å¯é ä¼ è¾“ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ TCP ä½¿ç”¨ æ»‘åŠ¨çª—å£ æ¥å®ç°å¯é ä¼ è¾“ã€‚TCP çš„æ»‘åŠ¨çª—å£æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œå¹¶å¯¹çª—å£å†…çš„å­—èŠ‚è¿›è¡Œç¼–å·ï¼Œå¦‚æœçª—å£å†…æŸä¸ªä½åºå·çš„å­—èŠ‚æœªæ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£å°†ä¸ä¼šå¾€åç§»ï¼Œè€Œä¼šåœ¨ç¡®è®¤è¶…æ—¶ä¹‹åï¼Œé‡æ–°ä¼ é€ï¼Œå³ è¶…æ—¶é‡ä¼ ã€‚è¿™æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å‡ºç°ï¼Œä¸€æ¡ TCP é“¾æ¥ï¼ŒæŸä¸ªæ—¶åˆ»å‘ç”Ÿäº†è¶…æ—¶é‡ä¼ ï¼Œå…¶ä»–æ•°æ®å¿…é¡»ç­‰è¿™ä¸ªé‡ä¼ æ¢å¤ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å‘é€ã€‚è€Œ HTTP/3 ä½¿ç”¨çš„ QUIC åè®®ä½¿ç”¨äº†å¤šè·¯æµå¤ç”¨ï¼ŒåŒä¸€ä¸ªä¼ è¾“é€šé“å¯ä»¥åŒæ—¶ä¼ è¾“å¤šè·¯æµï¼Œè€Œä¸åŒæµä¹Ÿä½¿ç”¨ä¸åŒçš„æµé‡æ§åˆ¶ã€æ»‘åŠ¨çª—å£ç­‰ï¼Œè¿™æ ·å³ä½¿æŸä¸€è·¯çš„æµé˜»å¡äº†ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–è·¯çš„æµã€‚</description>
      <content>&lt;blockquote&gt;
&lt;p&gt;TCP å¤„äºä¸ƒå±‚ç½‘ç»œæ¨¡å‹ï¼ˆåº”è¡¨ä¼šä¼ ç½‘æ•°ç‰©ï¼‰ä¸­çš„ä¼ è¾“å±‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ç‰¹ç‚¹&#34;&gt;ç‰¹ç‚¹&lt;/h2&gt;
&lt;h3 id=&#34;é¢å‘è¿æ¥&#34;&gt;é¢å‘è¿æ¥&lt;/h3&gt;
&lt;p&gt;å’Œ UDP ä¸ä¸€æ ·ï¼ŒTCP ä¼ è¾“æ•°æ®å‰éœ€è¦å…ˆå»ºç«‹ TCP è¿æ¥ï¼ˆæ­¤å¤„å¼•å‡ºä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ï¼‰ã€‚è€Œ UDP ä¼ è¾“æ•°æ®å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œä¹Ÿä¸ä¿è¯å¯é ä¼ è¾“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯é ä¼ è¾“&#34;&gt;å¯é ä¼ è¾“&lt;/h3&gt;
&lt;p&gt;TCP ä¿è¯ä¼ è¾“çš„æ•°æ®ï¼šæ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€ &lt;strong&gt;æŒ‰åºåˆ°è¾¾&lt;/strong&gt; ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å…¨åŒå·¥&#34;&gt;å…¨åŒå·¥&lt;/h3&gt;
&lt;p&gt;é€šä¿¡åŒæ–¹ä»»ä½•æ—¶å€™éƒ½èƒ½ç›¸äº’é€šä¿¡ã€‚å¹¶ä¸”éƒ½æœ‰å‘é€ç¼“å­˜ã€æ¥å—ç¼“å­˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¢å‘å­—èŠ‚æµ&#34;&gt;é¢å‘å­—èŠ‚æµ&lt;/h3&gt;
&lt;p&gt;è™½ç„¶åº”ç”¨å±‚å’Œ TCP çš„äº¤äº’æ˜¯ä¸€æ¬¡ä¸€ä¸ªæ•°æ®å—ï¼ˆå¤§å°ä¸ç­‰ï¼‰ï¼Œä½†æ˜¯ TCP æŠŠè¿™äº›æ•°æ®çœ‹æˆä»…ä»…æ˜¯ä¸€è¿ä¸²çš„æ— ç»“æ„å­—èŠ‚æµã€‚TCP å¹¶ä¸çŸ¥é“æ‰€ä¼ é€çš„å­—èŠ‚æµçš„å«ä¹‰ã€‚ä¼ è¾“è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://when.run/image/tcp_stream.jpg&#34; alt=&#34;tcp é¢å‘æµçš„æ¦‚å¿µ&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçœ‹åˆ°ï¼Œåº”ç”¨å±‚å‘é€å…¶å®ä¸æ˜¯åŒæ­¥å‘é€çš„ï¼Œè€Œåªæ˜¯æŠŠæ•°æ®æ‹·åˆ° TCP å‘é€ç¼“å­˜é‡Œï¼Œè€Œä¸‹ä¸€æ­¥å¦‚ä½•å‘é€ï¼Œå¦‚ä½•æŠŠæ•°æ®åˆ‡æˆæŠ¥æ–‡æ®µï¼Œéƒ½ä¸åº”ç”¨å±‚æ— å…³äº†ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºè¿™ä¸ªå­—èŠ‚æµä¼ è¾“æ¦‚å¿µï¼Œå¯¹äºå¶å°”èƒ½å¬åˆ°çš„ â€œé»åŒ…â€ æ¦‚å¿µä¹Ÿèƒ½è¾ƒä¸ºç›´æ¥çš„è§£é‡Šã€‚å› ä¸º TCP å¹¶æ²¡æœ‰åŒ…çš„æ¦‚å¿µï¼Œå› æ­¤è‡ªç„¶ä¹Ÿå°±ä¸å­˜åœ¨ â€œé»åŒ…â€ &lt;a href=&#34;https://draveness.me/whys-the-design-tcp-message-frame/&#34;&gt;ä¸ºä»€ä¹ˆ TCP åè®®æœ‰ç²˜åŒ…é—®é¢˜&lt;/a&gt;ã€‚&amp;ldquo;é»åŒ…&amp;rdquo; è¯¯è§£çš„åŸå› æ˜¯ï¼š&amp;ldquo;åº”ç”¨å±‚åè®®æ²¡æœ‰ä½¿ç”¨åŸºäºé•¿åº¦æˆ–è€…åŸºäºç»ˆç»“ç¬¦çš„æ¶ˆæ¯è¾¹ç•Œï¼Œå¯¼è‡´å¤šä¸ªæ¶ˆæ¯çš„ç²˜è¿&amp;rdquo;&lt;/p&gt;
&lt;h2 id=&#34;æŠ¥æ–‡æ®µå­—èŠ‚æµ&#34;&gt;æŠ¥æ–‡æ®µã€å­—èŠ‚æµ&lt;/h2&gt;
&lt;p&gt;TCP å­˜åœ¨ä¸€ä¸ª â€œæŠ¥æ–‡æ®µâ€ çš„æ¦‚å¿µï¼Œè¿™ä¸ªæŒ‡çš„æ˜¯ï¼šåœ¨ TCP æ¥æ”¶åˆ°åº”ç”¨å±‚å†™å…¥çš„æ•°æ®ä¹‹åï¼Œä¼šæš‚å­˜åˆ°å‘é€ç¼“å­˜ã€‚è€Œ TCP åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œä¼šä»å‘é€ç¼“å­˜ä¸­å–å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¹¶ä¸”åŠ ä¸Š TCP å±‚çš„ç‰¹å®šå¤´éƒ¨æ•°æ®ï¼Œå†å¾€ä¸‹ä¼ è¾“ç»™ IP å±‚ï¼ŒåŠ ä¸Šäº† TCP å¤´éƒ¨çš„è¿™éƒ¨åˆ†æ•°æ®ï¼Œå«åš TCP çš„ â€œæŠ¥æ–‡æ®µâ€ï¼Œè¿™ä¸ªæŠ¥æ–‡æ®µçš„æœ€å¤§é•¿åº¦å«åš &lt;em&gt;&lt;strong&gt;MSSï¼ˆæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ï¼‰&lt;/strong&gt;&lt;/em&gt;ã€‚è€Œåœ¨ä¼ è¾“æ—¶ï¼ŒæŠ¥æ–‡æ®µä¼šè¢«ä»¥å­—èŠ‚æµçš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°å­—èŠ‚æµä¹‹åï¼Œå†è§£æå­—èŠ‚æµè¿˜åŸæˆæŠ¥æ–‡æ®µï¼Œäº¤ä»˜ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯é ä¼ è¾“æ»‘åŠ¨çª—å£&#34;&gt;å¯é ä¼ è¾“ï¼ˆæ»‘åŠ¨çª—å£ï¼‰&lt;/h2&gt;
&lt;p&gt;TCP ä½¿ç”¨ &lt;strong&gt;æ»‘åŠ¨çª—å£&lt;/strong&gt; æ¥å®ç°å¯é ä¼ è¾“ã€‚TCP çš„æ»‘åŠ¨çª—å£æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œå¹¶å¯¹çª—å£å†…çš„å­—èŠ‚è¿›è¡Œç¼–å·ï¼Œå¦‚æœçª—å£å†…æŸä¸ªä½åºå·çš„å­—èŠ‚æœªæ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£å°†ä¸ä¼šå¾€åç§»ï¼Œè€Œä¼šåœ¨ç¡®è®¤è¶…æ—¶ä¹‹åï¼Œé‡æ–°ä¼ é€ï¼Œå³ &lt;strong&gt;è¶…æ—¶é‡ä¼ &lt;/strong&gt;ã€‚è¿™æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å‡ºç°ï¼Œä¸€æ¡ TCP é“¾æ¥ï¼ŒæŸä¸ªæ—¶åˆ»å‘ç”Ÿäº†è¶…æ—¶é‡ä¼ ï¼Œå…¶ä»–æ•°æ®å¿…é¡»ç­‰è¿™ä¸ªé‡ä¼ æ¢å¤ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å‘é€ã€‚è€Œ HTTP/3 ä½¿ç”¨çš„ QUIC åè®®ä½¿ç”¨äº†å¤šè·¯æµå¤ç”¨ï¼ŒåŒä¸€ä¸ªä¼ è¾“é€šé“å¯ä»¥åŒæ—¶ä¼ è¾“å¤šè·¯æµï¼Œè€Œä¸åŒæµä¹Ÿä½¿ç”¨ä¸åŒçš„æµé‡æ§åˆ¶ã€æ»‘åŠ¨çª—å£ç­‰ï¼Œè¿™æ ·å³ä½¿æŸä¸€è·¯çš„æµé˜»å¡äº†ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–è·¯çš„æµã€‚&lt;/p&gt;
&lt;h2 id=&#34;æµé‡æ§åˆ¶&#34;&gt;æµé‡æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æµé‡æ§åˆ¶ï¼ˆflow controlï¼‰&lt;/strong&gt; çš„ä½œç”¨æ˜¯è®©å‘é€æ–¹çš„å‘é€é€Ÿç‡ä¸è¦å¤ªå¿«ï¼Œè¦è®©æ¥æ”¶æ–¹æ¥å¾—åŠæ¥å—ã€‚&lt;/p&gt;
&lt;p&gt;å½“ TCP ç«¯ç‚¹ A å‘ TCP ç«¯ç‚¹ B å‘é€æ•°æ®æ—¶ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šå‡ºç°ä¸¤ä¸ªæ»‘åŠ¨çª—å£ï¼ŒA çš„å‘é€çª—å£å’Œ B çš„æ¥æ”¶çª—å£ã€‚å½“ B æ„Ÿå—åˆ°å‹åŠ›è¿‡å¤§ï¼Œæˆ–è€…å…¶ä»–åŸå› éœ€è¦è¿›è¡Œæµæ§æ—¶ï¼Œä¼šç»™å‘é€æ–¹å‘é€æ¶ˆæ¯ï¼Œå‘ŠçŸ¥å‘é€æ–¹ &lt;strong&gt;æ¥æ”¶çª—å£(rwnd)&lt;/strong&gt; çš„å¤§å°ï¼Œå‘é€æ–¹æ ¹æ®è¿™ä¸ªæ•°å€¼ï¼Œè°ƒæ•´å‘é€çª—å£çš„å¤§å°ã€‚åˆ©ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶å¯ä»¥æ–¹ä¾¿çš„åœ¨ TCP è¿æ¥ä¸Šå®ç°å¯¹å‘é€æ–¹çš„æµé‡æ§åˆ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‹¥å¡æ§åˆ¶&#34;&gt;æ‹¥å¡æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;å½“ç½‘ç»œé˜»å¡ï¼Œä¾‹å¦‚ï¼šé“¾è·¯ä¼ è¾“é€Ÿç‡åªæœ‰ 10Gb/s ï¼Œä½†æ˜¯æœ‰ 100 å°è®¡ç®—æœºï¼ŒåŒæ—¶ä»¥ 1Gb/s çš„é€Ÿç‡ä¼ è¾“ï¼Œè¿™æ—¶å€™å°±ä¼šå‘ç”Ÿæ‹¥å¡ï¼Œå¯¼è‡´ç½‘ç»œæ€§èƒ½å˜åï¼Œå› æ­¤éœ€è¦æ‹¥å¡æ§åˆ¶ï¼Œé˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œé¿å…ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–è€…é“¾è·¯è¿‡è½½ã€‚æ‹¥å¡æ§åˆ¶æœ‰å››ç§ç®—æ³•ï¼š&lt;strong&gt;æ…¢å¼€å§‹ï¼ˆslow-startï¼‰&lt;/strong&gt;ã€&lt;strong&gt;æ‹¥å¡é¿å…ï¼ˆcongestion avoidanceï¼‰&lt;/strong&gt;ã€&lt;strong&gt;å¿«é‡ä¼ ï¼ˆfast retransmitï¼‰&lt;/strong&gt;ã€&lt;strong&gt;å¿«æ¢å¤ï¼ˆfast recoveryï¼‰&lt;/strong&gt;ã€‚ è¿™é‡Œç½‘ç»œå‡ºç°æ‹¥å¡è¡¨ç°ä¸€èˆ¬ä¸ºï¼šæ•°æ®ä¸¢å¤±ï¼Œæ—¶å»¶å¢åŠ ï¼Œååé‡ä¸‹é™&lt;/p&gt;
&lt;h3 id=&#34;æ…¢å¼€å§‹æŒ‡æ•°å¢å¤§&#34;&gt;æ…¢å¼€å§‹ï¼ˆæŒ‡æ•°å¢å¤§ï¼‰&lt;/h3&gt;
&lt;p&gt;å‘é€æ–¹ç»´æŠ¤ä¸€ä¸ªæ‹¥å¡çª—å£ï¼Œè®©å‘é€çª—å£ç­‰äºæ‹¥å¡çª—å£ã€‚æœ€å¼€å§‹æŠŠæ‹¥å¡çª—å£è®¾ä¸º MSS å¤§å°ï¼Œæ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼Œå°±å¢åŠ ä¸€ä¸ª MSSï¼ˆè¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ²¡ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼Œæ‹¥å¡çª—å£å°±ä¼šåŠ å€ï¼‰ã€‚å½“æ‹¥å¡çª—å£å¢åŠ åˆ° &lt;strong&gt;æ…¢å¼€å§‹é—¨é™&lt;/strong&gt; ä¹‹åï¼Œæ”¹ç”¨ &lt;strong&gt;æ‹¥å¡é¿å…ç®—æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ‹¥å¡é¿å…åŠ æ³•å¢å¤§&#34;&gt;æ‹¥å¡é¿å…ï¼ˆåŠ æ³•å¢å¤§ï¼‰&lt;/h3&gt;
&lt;p&gt;ä¸å†æ¯æ”¶åˆ°ä¸€ä¸ª ACK å°±å¢åŠ ä¸€ä¸ª MSSï¼Œè€Œæ˜¯æ¯ç»è¿‡ä¸€ä¸ª RTTï¼ˆæŠŠå‘é€çª—å£éƒ½å‘é€å‡ºå»å¹¶æ”¶åˆ° ACKï¼‰ï¼Œå¢åŠ ä¸€ä¸ª MSSã€‚å½“å‘é€æ–¹åˆ¤æ–­ç½‘ç»œå‡ºç°æ‹¥å¡æ—¶ï¼ŒæŠŠæ…¢å¼€å§‹é—¨é™å‡ä¸ºå‘é€çª—å£çš„ä¸€åŠï¼Œå¹¶æŠŠæ‹¥å¡çª—å£è®¾ä¸º 1ï¼Œé‡æ–°å¼€å§‹æ…¢å¼€å§‹æµç¨‹&lt;/p&gt;
&lt;h3 id=&#34;å¿«é‡ä¼ &#34;&gt;å¿«é‡ä¼ &lt;/h3&gt;
&lt;p&gt;é¦–å…ˆè¦æ±‚æ¥æ”¶æ–¹æ¯æ¥æ”¶åˆ°ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œå°±å‘å‡ºé‡å¤ç¡®è®¤ï¼Œè®©å‘é€æ–¹èƒ½å°½å¿«é‡ä¼ ã€‚æ¥æ”¶æ–¹æ”¶åˆ° 3 ä¸ªé‡å¤ç¡®è®¤å°±åº”è¯¥å¼€å§‹é‡ä¼ å¯¹æ–¹æœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µï¼Œè€Œä¸æ˜¯ç­‰å¾…è®¡æ—¶å™¨è¿‡æœŸã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¿«æ¢å¤&#34;&gt;å¿«æ¢å¤&lt;/h3&gt;
&lt;p&gt;å½“å‘é€æ–¹æ”¶åˆ° 3 ä¸ªé‡å¤ç¡®è®¤ä¹‹åï¼ŒæŠŠæ‹¥å¡æ§åˆ¶è®¾ç½®ä¸ºæ…¢å¼€å§‹é—¨é™çš„ä¸€åŠï¼Œç„¶åå¼€å§‹æ‰§è¡Œæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼ˆåŠ æ³•å¢å¤§ï¼‰&lt;/p&gt;
&lt;p&gt;ç»“åˆæ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶ï¼Œå‘é€æ–¹çš„å‘é€çª—å£å€¼ä¸º &lt;code&gt;min(æ‹¥å¡çª—å£, æ¥æ”¶çª—å£)&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;è®¡ç®—æœºç½‘ç»œï¼ˆç¬¬å…­ç‰ˆ è°¢å¸Œä»è‘—ï¼‰&lt;/li&gt;
&lt;/ul&gt;
</content>
    </item>
    
    <item>
      <title>Python2 è¿ç§»åˆ° Python3 è§„åˆ’å’Œå®æ–½</title>
      <link>https://when.run/posts/python2-to-python3/</link>
      <pubDate>Tue, 12 Nov 2019 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/python2-to-python3/</guid>
      <description>å‰æœŸè§„åˆ’ åœ¨å¼€å§‹è¿ç§»å‰ï¼Œéœ€è¦å¤§è‡´ç›˜ç‚¹ä¸€ä¸‹éƒ½ä¼šæœ‰å“ªäº›å·¥ä½œé‡ï¼Œå“ªäº›ä»£ç éœ€è¦åšå…¼å®¹ï¼Œå“ªäº›æœåŠ¡éœ€è¦åšè¿ç§»ã€‚å‰æœŸå¯ä»¥å¤§æ¦‚åˆ†æˆä¸€ä¸‹å‡ éƒ¨åˆ†ï¼š
 ä¸»é¡¹ç›®ï¼ˆä¸»è¦çš„é¡¹ç›®ï¼Œæ‰¿æ‹…äº†ä¸»è¦çš„æ—¥å¸¸å¼€å‘ä»»åŠ¡ä»¥åŠä¸šåŠ¡éœ€æ±‚ï¼‰ å…¶ä»–æœåŠ¡ï¼ˆä¸ºä¸»é¡¹ç›®æœåŠ¡çš„å„ä¸ªæœåŠ¡ï¼Œå¦‚æ”¯ä»˜ã€IMã€å¹¿å‘Šç­‰ï¼‰ ä¾èµ–åº“ï¼Œä¾èµ–åˆåŒ…æ‹¬ï¼š  å…¬å¸å†…éƒ¨åŸºç¡€ç»„ä»¶ ç¬¬ä¸‰æ–¹ä¾èµ–    åœ¨åˆ—å‡ºæ‰€æœ‰çš„ &amp;ldquo;ä»£ç æ¸…å•&amp;rdquo; åï¼Œéœ€è¦æœ‰ä¸ªå…ˆåé¡ºåºï¼Œæ¥é€æ­¥çš„è¿›è¡Œè¿ç§»ã€‚é¦–å…ˆä¸Šé¢æåˆ°çš„ä¸‰ä¸ªå¤§ç‚¹ä¸­ï¼Œå…¶ä»–æœåŠ¡ å…¶å®ä¼˜å…ˆçº§å¹¶ä¸é«˜ï¼Œå› ä¸ºæ—¥å¸¸ä¸æ€ä¹ˆä¼šå¼€å‘ï¼Œå¤„äºç»´æŠ¤çŠ¶æ€ã€‚å› æ­¤ä¿æŒæ­£å¸¸è¿è¡Œå³å¯ï¼Œä¼˜å…ˆè¿›è¡Œå…¶ä»–ä¸¤é¡¹çš„è¿ç§»ã€‚è€Œä¾èµ–åº“å¤„å¤„åœ¨å¼•ç”¨ï¼Œä¸æå‰è¿›è¡Œ Python3 é€‚é…å…¶ä»–å·¥ä½œå°†æ— æ³•è¿›è¡Œã€‚å› æ­¤é€‚é…é¡ºåºå¦‚ä¸‹ï¼š
 æ’æŸ¥ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼Œæµ‹è¯•ï¼Œå‡çº§åˆ°å…¼å®¹ Python2/Python3 çš„ç‰ˆæœ¬ æ’æŸ¥å…¬å¸å†…éƒ¨åŸºç¡€ç»„ä»¶åº“ï¼Œæµ‹è¯•ï¼Œå…¼å®¹é€‚é… Python2/Python3 è¿›è¡Œä¸»é¡¹ç›®çš„ä»£ç å±‚é¢é€‚é…ï¼Œä½¿ç”¨å·¥å…·å’Œä¸€äº›åº“è¿›è¡Œ 2 å’Œ 3 çš„é€‚é…ï¼Œä½¿ç°æœ‰ä»£ç èƒ½åŒæ—¶åœ¨ 2 å’Œ 3 ä¸‹é¢è·‘ã€‚å¢åŠ  py3 ç¯å¢ƒçš„å•å…ƒæµ‹è¯•ã€‚  åœ¨ä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œè¿˜éœ€è¦ä¿è¯æ—¥å¸¸æ–°åŠ çš„ä»£ç ä¸å†å¼•å…¥ä¸å…¼å®¹çš„ä»£ç ï¼Œå› æ­¤åº”è¯¥æå‰ä½¿ç”¨ pre-commit å¯¹æ¯ä¸ª commit è¿›è¡Œæ£€æŸ¥ï¼Œä½¿ç”¨ pylint è¿›è¡Œå…¼å®¹æ€§æ£€æŸ¥ï¼Œé…ç½®å¦‚ä¸‹ï¼š
# .pre-commit-config.yaml - repo: https://github.com/xiachufang/mirrors-pylint rev: v1.9.2 hooks: - id: pylint args: - --py3k - --score=n è¿ç§»ä¸­ è¿ç§»åŠæ³•ä¸€èˆ¬æ˜¯å…ˆæ’æŸ¥å…³é”®å­—ï¼Œå¦‚ iteritems/itervalues/xrange ç­‰ï¼Œè¿™äº›å¯ä»¥å…¨éƒ¨ä½¿ç”¨ six ç›¸åº”æ–¹æ³•ç›´æ¥æ›¿æ¢ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œåº”è¯¥ç»™å•å…ƒæµ‹è¯•å¢åŠ  Python3 ç¯å¢ƒï¼Œè¿™æ ·é¦–å…ˆä¿è¯å•å…ƒæµ‹è¯•èƒ½åœ¨ Python3 ä¸‹è·‘é€šï¼Œåœ¨è°ƒé€šå•å…ƒæµ‹è¯•ä¹‹åï¼Œå¦‚æœæµ‹è¯•è¦†ç›–ç‡é«˜ï¼Œé‚£ä¹ˆåŸºæœ¬å·²ç»æ”¹å®Œå¾ˆå¤§ä¸€éƒ¨åˆ†ä»£ç äº†ã€‚åœ¨ç»™ä»£ç åšé€‚é…æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ futurize æ¥è‡ªåŠ¨ä¿®æ”¹ä¸€äº›ä»£ç ï¼Œå‡å°‘ä¸€äº›é‡å¤å·¥ä½œã€‚å¹¶ä¸”å¯ä»¥å‚è€ƒ futurize çš„ Cheat Sheet: Writing Python 2-3 compatible code æ¥åšå¯¹ç…§ï¼Œè¿›è¡Œä¿®æ”¹ä»£ç ã€‚</description>
      <content>&lt;h2 id=&#34;å‰æœŸè§„åˆ’&#34;&gt;å‰æœŸè§„åˆ’&lt;/h2&gt;
&lt;p&gt;åœ¨å¼€å§‹è¿ç§»å‰ï¼Œéœ€è¦å¤§è‡´ç›˜ç‚¹ä¸€ä¸‹éƒ½ä¼šæœ‰å“ªäº›å·¥ä½œé‡ï¼Œå“ªäº›ä»£ç éœ€è¦åšå…¼å®¹ï¼Œå“ªäº›æœåŠ¡éœ€è¦åšè¿ç§»ã€‚å‰æœŸå¯ä»¥å¤§æ¦‚åˆ†æˆä¸€ä¸‹å‡ éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸»é¡¹ç›®ï¼ˆä¸»è¦çš„é¡¹ç›®ï¼Œæ‰¿æ‹…äº†ä¸»è¦çš„æ—¥å¸¸å¼€å‘ä»»åŠ¡ä»¥åŠä¸šåŠ¡éœ€æ±‚ï¼‰&lt;/li&gt;
&lt;li&gt;å…¶ä»–æœåŠ¡ï¼ˆä¸ºä¸»é¡¹ç›®æœåŠ¡çš„å„ä¸ªæœåŠ¡ï¼Œå¦‚æ”¯ä»˜ã€IMã€å¹¿å‘Šç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;ä¾èµ–åº“ï¼Œä¾èµ–åˆåŒ…æ‹¬ï¼š
&lt;ul&gt;
&lt;li&gt;å…¬å¸å†…éƒ¨åŸºç¡€ç»„ä»¶&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ–¹ä¾èµ–&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨åˆ—å‡ºæ‰€æœ‰çš„ &amp;ldquo;ä»£ç æ¸…å•&amp;rdquo; åï¼Œéœ€è¦æœ‰ä¸ªå…ˆåé¡ºåºï¼Œæ¥é€æ­¥çš„è¿›è¡Œè¿ç§»ã€‚é¦–å…ˆä¸Šé¢æåˆ°çš„ä¸‰ä¸ªå¤§ç‚¹ä¸­ï¼Œ&lt;strong&gt;å…¶ä»–æœåŠ¡&lt;/strong&gt; å…¶å®ä¼˜å…ˆçº§å¹¶ä¸é«˜ï¼Œå› ä¸ºæ—¥å¸¸ä¸æ€ä¹ˆä¼šå¼€å‘ï¼Œå¤„äºç»´æŠ¤çŠ¶æ€ã€‚å› æ­¤ä¿æŒæ­£å¸¸è¿è¡Œå³å¯ï¼Œä¼˜å…ˆè¿›è¡Œå…¶ä»–ä¸¤é¡¹çš„è¿ç§»ã€‚è€Œä¾èµ–åº“å¤„å¤„åœ¨å¼•ç”¨ï¼Œä¸æå‰è¿›è¡Œ Python3 é€‚é…å…¶ä»–å·¥ä½œå°†æ— æ³•è¿›è¡Œã€‚å› æ­¤é€‚é…é¡ºåºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ’æŸ¥ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼Œæµ‹è¯•ï¼Œå‡çº§åˆ°å…¼å®¹ Python2/Python3 çš„ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;æ’æŸ¥å…¬å¸å†…éƒ¨åŸºç¡€ç»„ä»¶åº“ï¼Œæµ‹è¯•ï¼Œå…¼å®¹é€‚é… Python2/Python3&lt;/li&gt;
&lt;li&gt;è¿›è¡Œä¸»é¡¹ç›®çš„ä»£ç å±‚é¢é€‚é…ï¼Œä½¿ç”¨å·¥å…·å’Œä¸€äº›åº“è¿›è¡Œ 2 å’Œ 3 çš„é€‚é…ï¼Œä½¿ç°æœ‰ä»£ç èƒ½åŒæ—¶åœ¨ 2 å’Œ 3 ä¸‹é¢è·‘ã€‚å¢åŠ  py3 ç¯å¢ƒçš„å•å…ƒæµ‹è¯•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨ä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œè¿˜éœ€è¦ä¿è¯æ—¥å¸¸æ–°åŠ çš„ä»£ç ä¸å†å¼•å…¥ä¸å…¼å®¹çš„ä»£ç ï¼Œå› æ­¤åº”è¯¥æå‰ä½¿ç”¨ &lt;a href=&#34;https://pre-commit.com/&#34;&gt;pre-commit&lt;/a&gt; å¯¹æ¯ä¸ª commit è¿›è¡Œæ£€æŸ¥ï¼Œä½¿ç”¨ &lt;a href=&#34;https://github.com/pycqa/pylint&#34;&gt;pylint&lt;/a&gt; è¿›è¡Œå…¼å®¹æ€§æ£€æŸ¥ï¼Œé…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# .pre-commit-config.yaml&lt;/span&gt;

-   repo: https://github.com/xiachufang/mirrors-pylint
    rev: v1.9.2
    hooks:
    -   id: pylint
        args:
          - --py3k
          - --score&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;è¿ç§»ä¸­&#34;&gt;è¿ç§»ä¸­&lt;/h2&gt;
&lt;p&gt;è¿ç§»åŠæ³•ä¸€èˆ¬æ˜¯å…ˆæ’æŸ¥å…³é”®å­—ï¼Œå¦‚ &lt;code&gt;iteritems&lt;/code&gt;/&lt;code&gt;itervalues&lt;/code&gt;/&lt;code&gt;xrange&lt;/code&gt; ç­‰ï¼Œè¿™äº›å¯ä»¥å…¨éƒ¨ä½¿ç”¨ &lt;a href=&#34;https://six.readthedocs.io/&#34;&gt;six&lt;/a&gt; ç›¸åº”æ–¹æ³•ç›´æ¥æ›¿æ¢ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œåº”è¯¥ç»™å•å…ƒæµ‹è¯•å¢åŠ  Python3 ç¯å¢ƒï¼Œè¿™æ ·é¦–å…ˆä¿è¯å•å…ƒæµ‹è¯•èƒ½åœ¨ Python3 ä¸‹è·‘é€šï¼Œåœ¨è°ƒé€šå•å…ƒæµ‹è¯•ä¹‹åï¼Œå¦‚æœæµ‹è¯•è¦†ç›–ç‡é«˜ï¼Œé‚£ä¹ˆåŸºæœ¬å·²ç»æ”¹å®Œå¾ˆå¤§ä¸€éƒ¨åˆ†ä»£ç äº†ã€‚åœ¨ç»™ä»£ç åšé€‚é…æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;http://python-future.org/index.html&#34;&gt;futurize&lt;/a&gt; æ¥è‡ªåŠ¨ä¿®æ”¹ä¸€äº›ä»£ç ï¼Œå‡å°‘ä¸€äº›é‡å¤å·¥ä½œã€‚å¹¶ä¸”å¯ä»¥å‚è€ƒ futurize çš„ &lt;a href=&#34;http://python-future.org/compatible_idioms.html&#34;&gt;Cheat Sheet: Writing Python 2-3 compatible code&lt;/a&gt; æ¥åšå¯¹ç…§ï¼Œè¿›è¡Œä¿®æ”¹ä»£ç ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼šé‡åˆ°çš„é—®é¢˜&#34;&gt;ä¼šé‡åˆ°çš„é—®é¢˜&lt;/h3&gt;
&lt;h4 id=&#34;å…³é”®å­—æ–¹æ³•&#34;&gt;å…³é”®å­—/æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;ä¸Šé¢æœ‰æåˆ°ï¼ŒæŸäº›å…³é”®å­—æˆ–è€…æ–¹æ³•ï¼Œåˆ°äº† Python3 é‡Œé¢å·²ç»æ²¡æœ‰äº†ï¼Œæ¯”å¦‚ &lt;code&gt;xrange&lt;/code&gt;/&lt;code&gt;dict.iteritems&lt;/code&gt;/&lt;code&gt;dict.itervalues&lt;/code&gt;ï¼Œè¿™ä¸ªä¸€èˆ¬å…¨å±€æœç´¢å°±èƒ½æ’é™¤æ‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å†…ç½®å‡½æ•°è¿”å›ç±»å‹&#34;&gt;å†…ç½®å‡½æ•°è¿”å›ç±»å‹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ Python2 ä¸­ï¼Œ&lt;code&gt;dict.keys&lt;/code&gt; è¿”å›çš„æ˜¯ä¸€ä¸ª listï¼Œè€Œåˆ°äº† Python3 ä¸­ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª &lt;code&gt;dict_keys&lt;/code&gt;ï¼Œå¦‚æœå­˜åœ¨ä½¿ç”¨ä¸‹æ ‡å–ï¼Œé‚£ä¹ˆæ˜¯ä¼šæœ‰é—®é¢˜çš„ã€‚å¦‚ &lt;code&gt;{&amp;quot;K&amp;quot;: &amp;quot;V&amp;quot;}.keys()[0]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Python2 ä¸­ï¼Œmap/reduce/filter ä¹‹ç±»çš„å…³é”®å­—è¿”å›çš„æ˜¯ä¸ª listï¼Œåˆ°äº† 3 ä¸­ï¼Œè¿”å›çš„æ˜¯ generatorï¼Œå¦‚æœéœ€è¦ä¸‹æ ‡è®¿é—®æ˜¯éœ€è¦è½¬æˆ list/tuple çš„&lt;/li&gt;
&lt;li&gt;etc&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;strbytesunicode&#34;&gt;str/bytes/unicode&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªåº”å½“å±è¿ç§»çš„æœ€ç¹ççš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸­é—´é‡åˆ°ä¸€æ¬¡é—®é¢˜ï¼Œæ’æŸ¥äº†å¾ˆä¹…ã€‚ä»£ç åº“ä¸­æœ‰ä¸€ä¸ª &lt;code&gt;@cache&lt;/code&gt; è£…é¥°å™¨ï¼Œç”¨æ¥ç¼“å­˜å‡½æ•°è¿”å›å€¼ï¼Œåœ¨ py2 ä¸­æœ‰å¦‚ä¸‹ä¸€æ®µä»£ç :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;
&lt;span style=&#34;color:#a6e22e&#34;&gt;@cache&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;cache_key&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;foo&lt;/span&gt;():
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;py2 è¿”å›ç»“æ„&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;cache æ‹¿åˆ°å‡½æ•°è¿”å›å€¼åï¼ŒåŸæ ·æ”¾è¿› Memcachedï¼Œå› ä¸º Python2 ä¸­ï¼Œstr/bytes å®é™…ä¸Šæ˜¯ä¸æ•æ„Ÿçš„ï¼Œç”šè‡³å¯ä»¥ç­‰åŒã€‚è¯¥ &lt;code&gt;foo&lt;/code&gt; å‡½æ•°åœ¨ py2 ä¸‹è¿”å›çš„æ˜¯ä¸€ä¸ªå¸¦ encoding çš„ strï¼Œå¯ä»¥çœ‹åšæ˜¯ bytes ç±»å‹ï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœåœ¨ py3 ä¸‹æŠŠç¼“å­˜ç»“æœå–å‡ºæ¥ï¼Œé‚£ä¹ˆå°†ä¼šæ˜¯æ‹¿åˆ°ä¸€ä¸ª bytes ç±»å‹: &lt;code&gt;b&amp;quot;py2 è¿”å›ç»“æ„&amp;quot;&lt;/code&gt;ï¼Œè¿™é‡Œå°±å¾ˆå®¹æ˜“å‡ºé”™äº†ï¼Œåœ¨ Python2 ä¸‹æ—¶ï¼Œè¿™ä¸ªå’Œ str ä¸€æ ·ï¼Œå¯ä»¥å½“åš str å¤„ç†ï¼Œä½†æ˜¯ Python3 å¿…é¡»æ­£è§†ç±»å‹ï¼Œè¯¥ç”¨ str(text type) å°±ä¸èƒ½ç”¨ bytesã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»£ç åº“è¿ç§»å®Œæˆ&#34;&gt;ä»£ç åº“è¿ç§»å®Œæˆ&lt;/h2&gt;
&lt;p&gt;æŠŠä»£ç åº“å…¨éƒ¨å…¼å®¹ Python2 å’Œ Python3 ä¹‹åï¼Œè¿™æ—¶å€™ä»£ç åº“æ˜¯å¯ä»¥åŒæ—¶åœ¨ Python2 å’Œ Python3 ä¸Šè·‘çš„ï¼Œå› æ­¤å¯ä»¥é€æ­¥å¼€å§‹åˆ‡åˆ†æµé‡ï¼Œå¤§æ¦‚å¯ä»¥åˆ†æˆè¿™ä¹ˆå‡ ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æŠŠ staging æµé‡å¤åˆ¶åˆ° Python3 çš„ç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;éƒ¨ç½² production çš„ Python3 ç¯å¢ƒï¼Œå¹¶åˆ‡åˆ†åŠå…¬å®¤æµé‡è‡³ Python3 ç¯å¢ƒ&lt;/li&gt;
&lt;li&gt;åˆ‡åˆ†çº¿ä¸Šå°éƒ¨åˆ†æµé‡åˆ° Python3 ç¯å¢ƒï¼Œå¹¶é€æ­¥å¢åŠ ï¼Œç›´è‡³å…¨éƒ¨è¦†ç›–&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è¿ç§»åå·¥ä½œ&#34;&gt;è¿ç§»åå·¥ä½œ&lt;/h2&gt;
&lt;p&gt;å…¨éƒ¨è¿ç§»å®Œæˆåï¼Œè‡ªç„¶ä¼šç»™ä»£ç åŠ ä¸Š type hintï¼Œå‰æœŸå¯ä»¥ä½¿ç”¨ pre-commit å¢åŠ  mypy ç±»å‹æ£€æŸ¥ï¼Œå¹¶ä¸”åªæ£€æŸ¥æ”¹åŠ¨åˆ°çš„æ–‡ä»¶ã€‚ä¸æ­¤åŒæ—¶ï¼Œä½¿ç”¨ &lt;a href=&#34;https://github.com/Instagram/MonkeyType&#34;&gt;MonkeyType&lt;/a&gt; æ”¶é›†ç±»å‹ï¼Œè‡ªåŠ¨æ·»åŠ ä¸€éƒ¨åˆ†ï¼Œå‡å°‘å·¥ä½œé‡ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œè¿ç§»å·¥ä½œå·²ç»å…¨éƒ¨å®Œæˆã€‚&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>About</title>
      <link>https://when.run/about/</link>
      <pubDate>Fri, 08 Nov 2019 13:05:26 +0800</pubDate>
      
      <guid>https://when.run/about/</guid>
      <description>&amp;ldquo;å¥¥åˆ©ç»™!&amp;rdquo;
 GitHub: x1ah Telegram: x1ahh QQ: äºŒç»´ç   </description>
      <content>&lt;p&gt;&amp;ldquo;å¥¥åˆ©ç»™!&amp;rdquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GitHub: &lt;a href=&#34;https://github.com/x1ah&#34;&gt;x1ah&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Telegram: &lt;a href=&#34;https://telegram.me/x1ahh&#34;&gt;x1ahh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;QQ: &lt;a href=&#34;http://i.imgur.com/s4mteP9.jpg&#34;&gt;äºŒç»´ç &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    </item>
    
    <item>
      <title>å‘é‡æ—¶é’Ÿ(Vector Clock)</title>
      <link>https://when.run/posts/vector-clock/</link>
      <pubDate>Fri, 08 Nov 2019 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/vector-clock/</guid>
      <description>å‘é‡æ—¶é’Ÿ(Vector Clock) å‘é‡æ—¶é’Ÿæ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ£€æµ‹äº‹ä»¶å› æœå…³ç³»çš„ä¸€ç§ç®—æ³•ã€‚å¦‚å›¾ï¼šç³»ç»Ÿä¸­æœ‰ ABC ä¸‰ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤è‡ªå·±çš„ä¸€ä¸ªå‘é‡æ—¶é’Ÿï¼Œæ—¶é’Ÿçš„è§„åˆ™å¦‚ä¸‹ï¼š
 åˆå§‹æ—¶ï¼Œæ‰€æœ‰è¿›ç¨‹çš„æ—¶é’Ÿéƒ½ä¸º 0 è¿›ç¨‹æ¯æ¬¡å¤„ç†ä¸€ä¸ªå†…éƒ¨äº‹ä»¶ï¼Œå…¶é€»è¾‘æ—¶é’ŸåŠ  1 æ¯æ¬¡å‘é€æ¶ˆæ¯ï¼Œå…¶é€»è¾‘æ—¶é’ŸåŠ  1ï¼Œå¹¶ä¸”å°†å…¶å‘é‡æ—¶é’Ÿä¸€èµ·å‘é€ æ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯ï¼Œå…¶é€»è¾‘æ—¶é’ŸåŠ  1ï¼Œå¹¶æ›´æ–°æœ¬åœ°æ—¶é’Ÿï¼Œé€»è¾‘æ—¶é’Ÿçš„å€¼ä¸ºæœ¬åœ°æ—¶é’Ÿé‡Œå€¼çš„æœ€å¤§å€¼  æ¯ä¸ªè¿›ç¨‹ç»´æŠ¤çš„æ‰€æœ‰é€»è¾‘æ—¶é’Ÿä¸ºä¸€ä¸ªå‘é‡æ—¶é’Ÿã€‚å‡è®¾è¿›ç¨‹ A å‘é‡æ—¶é’Ÿå¦‚ä¸‹ï¼š
+----+ |A:0 | |B:3 | ===&amp;gt; è¿™ä¸ªæ•´ä½“ç§°ä¸º A çš„ &amp;#34;å‘é‡æ—¶é’Ÿ&amp;#34;ï¼Œå…¶ä¸­ï¼ŒA:0 ä¸º A çš„é€»è¾‘æ—¶é’Ÿ |C:5 | +----+ å› æœå…³ç³»åˆ¤æ–­è§„åˆ™  å¦‚æœæ—¶é’Ÿ V1 çš„æ¯ä¸ªé€»è¾‘æ—¶é’Ÿå€¼éƒ½æ¯”æ—¶é’Ÿ V2 å¤§ï¼Œé‚£ä¹ˆç§° V1 æ¯” V2 å…ˆå‘ç”Ÿã€‚å¦‚ï¼š V1: [A:2,B:4,C:2] ä¸ V2: [A:1,B:2,C:1] å¦‚æœä¸æ»¡è¶³æ¡ä»¶ 1), å³æœ‰çš„å€¼ V1 æ¯” V2 å¤§ï¼Œæœ‰çš„ V2 æ¯” V1 å¤§ï¼Œé‚£ä¹ˆçœ‹åšä¸¤ä¸ªäº‹ä»¶åŒæ—¶å‘ç”Ÿ  åº”ç”¨ å‘é‡æ—¶é’Ÿé€šå¸¸ç”¨äºæ£€æµ‹ replication ä¹‹é—´çš„æ•°æ®å†²çªã€‚ä¾‹å¦‚ Dynamo: Data Versioning With DynamoDBã€‚</description>
      <content>&lt;h2 id=&#34;å‘é‡æ—¶é’Ÿvector-clock&#34;&gt;å‘é‡æ—¶é’Ÿ(Vector Clock)&lt;/h2&gt;
&lt;p&gt;å‘é‡æ—¶é’Ÿæ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ£€æµ‹äº‹ä»¶å› æœå…³ç³»çš„ä¸€ç§ç®—æ³•ã€‚å¦‚å›¾ï¼š&lt;img src=&#34;https://i.imgur.com/0XRtT9o.png&#34; alt=&#34;Imgur&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿä¸­æœ‰ ABC ä¸‰ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤è‡ªå·±çš„ä¸€ä¸ªå‘é‡æ—¶é’Ÿï¼Œæ—¶é’Ÿçš„è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆå§‹æ—¶ï¼Œæ‰€æœ‰è¿›ç¨‹çš„æ—¶é’Ÿéƒ½ä¸º 0&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹æ¯æ¬¡å¤„ç†ä¸€ä¸ªå†…éƒ¨äº‹ä»¶ï¼Œå…¶é€»è¾‘æ—¶é’ŸåŠ  1&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡å‘é€æ¶ˆæ¯ï¼Œå…¶é€»è¾‘æ—¶é’ŸåŠ  1ï¼Œå¹¶ä¸”å°†å…¶å‘é‡æ—¶é’Ÿä¸€èµ·å‘é€&lt;/li&gt;
&lt;li&gt;æ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯ï¼Œå…¶é€»è¾‘æ—¶é’ŸåŠ  1ï¼Œå¹¶æ›´æ–°æœ¬åœ°æ—¶é’Ÿï¼Œé€»è¾‘æ—¶é’Ÿçš„å€¼ä¸ºæœ¬åœ°æ—¶é’Ÿé‡Œå€¼çš„æœ€å¤§å€¼&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯ä¸ªè¿›ç¨‹ç»´æŠ¤çš„æ‰€æœ‰é€»è¾‘æ—¶é’Ÿä¸ºä¸€ä¸ªå‘é‡æ—¶é’Ÿã€‚å‡è®¾è¿›ç¨‹ A å‘é‡æ—¶é’Ÿå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+----+&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;A:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;B:&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;===&amp;gt;&lt;/span&gt;  è¿™ä¸ªæ•´ä½“ç§°ä¸º A çš„ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å‘é‡æ—¶é’Ÿ&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼Œ&lt;/span&gt;å…¶ä¸­&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ï¼Œ&lt;/span&gt;A:&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; ä¸º A çš„é€»è¾‘æ—¶é’Ÿ
&lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;C:&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;+----+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å› æœå…³ç³»åˆ¤æ–­è§„åˆ™&#34;&gt;å› æœå…³ç³»åˆ¤æ–­è§„åˆ™&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœæ—¶é’Ÿ V1 çš„æ¯ä¸ªé€»è¾‘æ—¶é’Ÿå€¼éƒ½æ¯”æ—¶é’Ÿ V2  å¤§ï¼Œé‚£ä¹ˆç§° V1 æ¯” V2 å…ˆå‘ç”Ÿã€‚å¦‚ï¼š &lt;code&gt;V1: [A:2,B:4,C:2]&lt;/code&gt; ä¸ &lt;code&gt;V2: [A:1,B:2,C:1]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸æ»¡è¶³æ¡ä»¶ 1), å³æœ‰çš„å€¼ V1 æ¯” V2 å¤§ï¼Œæœ‰çš„ V2 æ¯” V1 å¤§ï¼Œé‚£ä¹ˆçœ‹åšä¸¤ä¸ªäº‹ä»¶åŒæ—¶å‘ç”Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;åº”ç”¨&#34;&gt;åº”ç”¨&lt;/h2&gt;
&lt;p&gt;å‘é‡æ—¶é’Ÿé€šå¸¸ç”¨äºæ£€æµ‹ replication ä¹‹é—´çš„æ•°æ®å†²çªã€‚ä¾‹å¦‚ Dynamo: &lt;a href=&#34;https://cloudacademy.com/blog/data-versioning-with-dynamodb-an-inside-look-into-nosql-part-5/&#34;&gt;Data Versioning With DynamoDB&lt;/a&gt;ã€‚&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿ</title>
      <link>https://when.run/posts/miao-sha/</link>
      <pubDate>Wed, 02 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/miao-sha/</guid>
      <description>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿ  æ€»ç»“æå®¢æ—¶é—´ä¸“æ ã€Šå¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿã€‹
 æå®¢æ—¶é—´
é—®é¢˜ å…¶å®è¿™ç±»é«˜å¹¶å‘é—®é¢˜ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ä¸¤ç‚¹ï¼Œå¹¶å‘è¯»ã€ å¹¶å‘å†™ã€‚å¹¶ä¸”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿè¿˜éœ€è¦åšåˆ°ï¼š
 é«˜æ€§èƒ½ï¼šæ”¯æŒå¹¶å‘è¯»å¹¶å‘å†™ ä¸€è‡´æ€§ï¼šä¿è¯ç³»ç»Ÿæ­£ç¡®ï¼Œå¦‚ä¸å‘ç”Ÿè¶…å–ç­‰ é«˜å¯ç”¨ï¼šä¿è¯ç³»ç»Ÿåœ¨æç«¯æ¡ä»¶ä¸‹çš„å¯ç”¨æ€§ï¼ŒPlanB ç­‰   åŸåˆ™  æ•°æ®å°½é‡å°‘ï¼šc-s ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å°½é‡å°‘ï¼Œå‡å°‘ä¼ è¾“æ—¶é—´ è¯·æ±‚æ•°å°½é‡å°‘ï¼šå‡å°‘èµ„æºæ¶ˆè€— è·¯å¾„å°½é‡çŸ­ï¼šè¯·æ±‚ä¼šç»è¿‡è‹¥å¹²ä¸ªä¸­é—´ä»¶ï¼Œç»è¿‡çš„ä¸­é—´ä»¶åº”è¯¥å°½é‡å°‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½ä¼šæŒ‚ï¼Œæœ€åæ•´ä½“å¯ç”¨æ€§(&amp;lt;1)å°±æ˜¯ç»è¿‡çš„æ‰€æœ‰èŠ‚ç‚¹å¯ç”¨æ€§çš„ä¹˜ç§¯ ä¾èµ–å°½é‡å°‘ï¼šæŒ‡çš„æ˜¯ä¸šåŠ¡ä¾èµ–ï¼ˆä¼˜æƒ åˆ¸ã€ç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰ï¼Œé˜²æ­¢ä¸»è¦æœåŠ¡è¢«å…¶ä»–é™„å±ä¾èµ–ç»™æ‹–å®æ‰ ä¸è¦æœ‰å•ç‚¹ï¼šå•ç‚¹å°±æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€å¼±çš„åœ°æ–¹ï¼Œå¾ˆå®¹æ˜“è¢«å‡»å®   åŠ¨é™åˆ†ç¦» é™æ€æ•°æ®  ç»Ÿä¸€ cache å±‚ CDN ä»£ç†æœåŠ¡å™¨ç¼“å­˜  åŠ¨æ€æ•°æ®  ä¸šåŠ¡éš”ç¦»ï¼šå¿…é¡»å‚åŠ æ´»åŠ¨éœ€è¦æå‰æŠ¥åï¼ŒæœåŠ¡å™¨å¯¹è¿™äº›çƒ­ç‚¹è¿›è¡Œé¢„çƒ­ ç³»ç»Ÿéš”ç¦»ï¼šç§’æ€ç³»ç»Ÿå•ç‹¬éƒ¨ç½²ï¼Œè½åˆ°ä¸åŒé›†ç¾¤å½“ä¸­ï¼Œé¿å…æ‹–å®å…¶ä»–æœåŠ¡ æ•°æ®éš”ç¦»ï¼šé’ˆå¯¹è¿™äº›çƒ­ç‚¹æ•°æ®ï¼Œæ¯”å¦‚å¯ç”¨å•ç‹¬çš„ cache æˆ– MySQL å®ä¾‹   æµé‡å‰Šå³° é¢å¯¹ç§’æ€ç³»ç»Ÿéœ€è¦æ‰¿å—çš„æµ·é‡æµé‡ï¼Œå¦‚æœå…¨éƒ¨è½åˆ°æ•°æ®åº“ä¸Šï¼Œé‚£ä¹ˆæ•°æ®åº“å°†ä¸å ªé‡è´Ÿï¼Œå› æ­¤å¯ä»¥è¿›è¡Œåˆ†å±‚çš„æµé‡å‰Šå³°ï¼š
 ç­”é¢˜ã€éªŒè¯ç ç­‰ï¼Œåœ¨å®¢æˆ·ç«¯ç›´æ¥è¿‡æ»¤ï¼Œå°†æµé‡æ‘Šå¹³ï¼Œè€Œä¸æ˜¯ç¬æ—¶æ´ªå³°æµé‡ æœåŠ¡ç«¯è¯·æ±‚æ’é˜Ÿï¼Œè¯·æ±‚åˆ°è¾¾äº†ä¸å³æ—¶è¿”å›ï¼Œè€Œæ˜¯å¡è¿›é˜Ÿåˆ—é‡Œï¼ŒFIFO æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œç„¶åå¼‚æ­¥é€šçŸ¥å®¢æˆ·ç«¯ï¼ˆä½“éªŒä¸å¥½ï¼Œç”¨æˆ·æ— æ³•å®æ—¶æ”¶åˆ°åé¦ˆï¼‰ åˆ†å±‚æ ¡éªŒï¼Œä¿è¯è½åˆ°æ•°æ®åº“çš„è¯·æ±‚éƒ½æ˜¯æœ‰æ•ˆè¯·æ±‚   å‡åº“å­˜ å‡åº“å­˜æ˜¯æœ€å…³é”®çš„ä¸€ä¸ªé€»è¾‘ï¼Œéœ€è¦ä¿è¯é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå‘ç”Ÿè¶…å”®ã€‚å¸¸ç”¨çš„æœ‰ä¸‰ç§å‡åº“å­˜æ–¹æ¡ˆï¼š
 ä¸‹å•å‡åº“å­˜ï¼šä¸‹å•å°±å‡åº“å­˜ï¼Œä¼šäº§ç”Ÿéå¸¸å¤šæ— æ•ˆè®¢å•ï¼Œä½“éªŒä¸å¥½ã€‚ ä»˜æ¬¾å‡åº“å­˜ï¼šå¯èƒ½ä¼šæœ‰ç”¨æˆ·åœ¨ä»˜æ¬¾å®Œæˆä¹‹åï¼Œç»“æœæç¤ºæ²¡åº“å­˜äº†ã€‚ é¢„æ‰£åº“å­˜ï¼šç”¨æˆ·ä¸‹å•åå‡åº“å­˜ï¼Œä½†æ˜¯åº“å­˜åªæœ‰å‡ åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè¿‡äº†æœ‰æ•ˆæœŸå°±å›æ”¶åº“å­˜ï¼Œä½“éªŒè¾ƒå¥½ã€‚   PlanB é«˜å¯ç”¨ç³»ç»Ÿçš„ PlanBï¼Œé’ˆå¯¹ç§’æ€ç³»ç»Ÿï¼Œå¯ä»¥åšä¸€äº›äº‹ï¼Œæ¯”å¦‚ï¼š
 é™çº§ï¼šå¦‚ç³»ç»Ÿå®¹é‡åˆ°è¾¾ä¸€ç‚¹ç¨‹åº¦ä¹‹åï¼Œå…³é—­ä¸€äº›éæ ¸å¿ƒåŠŸèƒ½ï¼ŒæŠŠæœ‰é™çš„èµ„æºè®©ç»™æ ¸å¿ƒåŠŸèƒ½ é™æµï¼šåœ¨äº‹å…ˆè¿›è¡Œå‹åŠ›æµ‹è¯•æ—¶ï¼Œé¢„ä¼°ä¸€ä¸ªæœ€é«˜ QPSï¼Œå¹¶å°†å…¶è®¾ä¸ºé˜ˆå€¼ï¼Œåˆ°è¾¾è¿™ä¸ªé˜ˆå€¼ä¹‹åï¼Œå…¶ä»–è¯·æ±‚æ‰”é˜Ÿåˆ—æˆ–è€…ç›´æ¥ä¸¢å¼ƒ æ‹’ç»æœåŠ¡ï¼šæœ€åçš„æƒ…å†µï¼Œè¾¾åˆ°æŸä¸ªä¸´ç•Œç‚¹ï¼ˆCPU 90%ï¼‰ç›´æ¥æ‹’ç»æœåŠ¡ï¼Œä¿æŠ¤æœåŠ¡ï¼Œç­‰è´Ÿè½½ä¸‹é™ä¹‹åæ¢å¤ï¼Œé¿å…è¢«ç›´æ¥é•¿æ—¶é—´æ‹–å®ã€‚  </description>
      <content>&lt;h1 id=&#34;å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿ&#34;&gt;å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿ&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;æ€»ç»“æå®¢æ—¶é—´ä¸“æ ã€Šå¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿã€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://time.geekbang.org/column/127&#34;&gt;æå®¢æ—¶é—´&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜&lt;/h1&gt;
&lt;p&gt;å…¶å®è¿™ç±»é«˜å¹¶å‘é—®é¢˜ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ä¸¤ç‚¹ï¼Œ&lt;code&gt;å¹¶å‘è¯»&lt;/code&gt;ã€ &lt;code&gt;å¹¶å‘å†™&lt;/code&gt;ã€‚å¹¶ä¸”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿè¿˜éœ€è¦åšåˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜æ€§èƒ½ï¼šæ”¯æŒå¹¶å‘è¯»å¹¶å‘å†™&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§ï¼šä¿è¯ç³»ç»Ÿæ­£ç¡®ï¼Œå¦‚ä¸å‘ç”Ÿè¶…å–ç­‰&lt;/li&gt;
&lt;li&gt;é«˜å¯ç”¨ï¼šä¿è¯ç³»ç»Ÿåœ¨æç«¯æ¡ä»¶ä¸‹çš„å¯ç”¨æ€§ï¼ŒPlanB ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;åŸåˆ™&#34;&gt;åŸåˆ™&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®å°½é‡å°‘ï¼šc-s ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å°½é‡å°‘ï¼Œå‡å°‘ä¼ è¾“æ—¶é—´&lt;/li&gt;
&lt;li&gt;è¯·æ±‚æ•°å°½é‡å°‘ï¼šå‡å°‘èµ„æºæ¶ˆè€—&lt;/li&gt;
&lt;li&gt;è·¯å¾„å°½é‡çŸ­ï¼šè¯·æ±‚ä¼šç»è¿‡è‹¥å¹²ä¸ªä¸­é—´ä»¶ï¼Œç»è¿‡çš„ä¸­é—´ä»¶åº”è¯¥å°½é‡å°‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½ä¼šæŒ‚ï¼Œæœ€åæ•´ä½“å¯ç”¨æ€§(&amp;lt;1)å°±æ˜¯ç»è¿‡çš„æ‰€æœ‰èŠ‚ç‚¹å¯ç”¨æ€§çš„ä¹˜ç§¯&lt;/li&gt;
&lt;li&gt;ä¾èµ–å°½é‡å°‘ï¼šæŒ‡çš„æ˜¯ä¸šåŠ¡ä¾èµ–ï¼ˆä¼˜æƒ åˆ¸ã€ç”¨æˆ·ä¿¡æ¯ç­‰ï¼‰ï¼Œé˜²æ­¢ä¸»è¦æœåŠ¡è¢«å…¶ä»–é™„å±ä¾èµ–ç»™æ‹–å®æ‰&lt;/li&gt;
&lt;li&gt;ä¸è¦æœ‰å•ç‚¹ï¼šå•ç‚¹å°±æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€å¼±çš„åœ°æ–¹ï¼Œå¾ˆå®¹æ˜“è¢«å‡»å®&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;åŠ¨é™åˆ†ç¦»&#34;&gt;åŠ¨é™åˆ†ç¦»&lt;/h1&gt;
&lt;h2 id=&#34;é™æ€æ•°æ®&#34;&gt;é™æ€æ•°æ®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç»Ÿä¸€ cache å±‚&lt;/li&gt;
&lt;li&gt;CDN&lt;/li&gt;
&lt;li&gt;ä»£ç†æœåŠ¡å™¨ç¼“å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åŠ¨æ€æ•°æ®&#34;&gt;åŠ¨æ€æ•°æ®&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸šåŠ¡éš”ç¦»ï¼šå¿…é¡»å‚åŠ æ´»åŠ¨éœ€è¦æå‰æŠ¥åï¼ŒæœåŠ¡å™¨å¯¹è¿™äº›çƒ­ç‚¹è¿›è¡Œé¢„çƒ­&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿéš”ç¦»ï¼šç§’æ€ç³»ç»Ÿå•ç‹¬éƒ¨ç½²ï¼Œè½åˆ°ä¸åŒé›†ç¾¤å½“ä¸­ï¼Œé¿å…æ‹–å®å…¶ä»–æœåŠ¡&lt;/li&gt;
&lt;li&gt;æ•°æ®éš”ç¦»ï¼šé’ˆå¯¹è¿™äº›çƒ­ç‚¹æ•°æ®ï¼Œæ¯”å¦‚å¯ç”¨å•ç‹¬çš„ cache æˆ– MySQL å®ä¾‹&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;æµé‡å‰Šå³°&#34;&gt;æµé‡å‰Šå³°&lt;/h1&gt;
&lt;p&gt;é¢å¯¹ç§’æ€ç³»ç»Ÿéœ€è¦æ‰¿å—çš„æµ·é‡æµé‡ï¼Œå¦‚æœå…¨éƒ¨è½åˆ°æ•°æ®åº“ä¸Šï¼Œé‚£ä¹ˆæ•°æ®åº“å°†ä¸å ªé‡è´Ÿï¼Œå› æ­¤å¯ä»¥è¿›è¡Œåˆ†å±‚çš„æµé‡å‰Šå³°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç­”é¢˜ã€éªŒè¯ç ç­‰ï¼Œåœ¨å®¢æˆ·ç«¯ç›´æ¥è¿‡æ»¤ï¼Œå°†æµé‡æ‘Šå¹³ï¼Œè€Œä¸æ˜¯ç¬æ—¶æ´ªå³°æµé‡&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯è¯·æ±‚æ’é˜Ÿï¼Œè¯·æ±‚åˆ°è¾¾äº†ä¸å³æ—¶è¿”å›ï¼Œè€Œæ˜¯å¡è¿›é˜Ÿåˆ—é‡Œï¼ŒFIFO æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œç„¶åå¼‚æ­¥é€šçŸ¥å®¢æˆ·ç«¯ï¼ˆä½“éªŒä¸å¥½ï¼Œç”¨æˆ·æ— æ³•å®æ—¶æ”¶åˆ°åé¦ˆï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†å±‚æ ¡éªŒï¼Œä¿è¯è½åˆ°æ•°æ®åº“çš„è¯·æ±‚éƒ½æ˜¯æœ‰æ•ˆè¯·æ±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/fb7F5UO.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&#34;å‡åº“å­˜&#34;&gt;å‡åº“å­˜&lt;/h1&gt;
&lt;p&gt;å‡åº“å­˜æ˜¯æœ€å…³é”®çš„ä¸€ä¸ªé€»è¾‘ï¼Œéœ€è¦ä¿è¯é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå‘ç”Ÿè¶…å”®ã€‚å¸¸ç”¨çš„æœ‰ä¸‰ç§å‡åº“å­˜æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸‹å•å‡åº“å­˜ï¼šä¸‹å•å°±å‡åº“å­˜ï¼Œä¼šäº§ç”Ÿéå¸¸å¤šæ— æ•ˆè®¢å•ï¼Œä½“éªŒä¸å¥½ã€‚&lt;/li&gt;
&lt;li&gt;ä»˜æ¬¾å‡åº“å­˜ï¼šå¯èƒ½ä¼šæœ‰ç”¨æˆ·åœ¨ä»˜æ¬¾å®Œæˆä¹‹åï¼Œç»“æœæç¤ºæ²¡åº“å­˜äº†ã€‚&lt;/li&gt;
&lt;li&gt;é¢„æ‰£åº“å­˜ï¼šç”¨æˆ·ä¸‹å•åå‡åº“å­˜ï¼Œä½†æ˜¯åº“å­˜åªæœ‰å‡ åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè¿‡äº†æœ‰æ•ˆæœŸå°±å›æ”¶åº“å­˜ï¼Œä½“éªŒè¾ƒå¥½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;planb&#34;&gt;PlanB&lt;/h1&gt;
&lt;p&gt;é«˜å¯ç”¨ç³»ç»Ÿçš„ PlanBï¼Œé’ˆå¯¹ç§’æ€ç³»ç»Ÿï¼Œå¯ä»¥åšä¸€äº›äº‹ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é™çº§ï¼šå¦‚ç³»ç»Ÿå®¹é‡åˆ°è¾¾ä¸€ç‚¹ç¨‹åº¦ä¹‹åï¼Œå…³é—­ä¸€äº›éæ ¸å¿ƒåŠŸèƒ½ï¼ŒæŠŠæœ‰é™çš„èµ„æºè®©ç»™æ ¸å¿ƒåŠŸèƒ½&lt;/li&gt;
&lt;li&gt;é™æµï¼šåœ¨äº‹å…ˆè¿›è¡Œå‹åŠ›æµ‹è¯•æ—¶ï¼Œé¢„ä¼°ä¸€ä¸ªæœ€é«˜ QPSï¼Œå¹¶å°†å…¶è®¾ä¸ºé˜ˆå€¼ï¼Œåˆ°è¾¾è¿™ä¸ªé˜ˆå€¼ä¹‹åï¼Œå…¶ä»–è¯·æ±‚æ‰”é˜Ÿåˆ—æˆ–è€…ç›´æ¥ä¸¢å¼ƒ&lt;/li&gt;
&lt;li&gt;æ‹’ç»æœåŠ¡ï¼šæœ€åçš„æƒ…å†µï¼Œè¾¾åˆ°æŸä¸ªä¸´ç•Œç‚¹ï¼ˆCPU 90%ï¼‰ç›´æ¥æ‹’ç»æœåŠ¡ï¼Œä¿æŠ¤æœåŠ¡ï¼Œç­‰è´Ÿè½½ä¸‹é™ä¹‹åæ¢å¤ï¼Œé¿å…è¢«ç›´æ¥é•¿æ—¶é—´æ‹–å®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://i.imgur.com/vRlVzqW.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title> å¦‚ä½•å¼€å‘ Flask æ‰©å±•</title>
      <link>https://when.run/posts/flask-extensions/</link>
      <pubDate>Sat, 28 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>https://when.run/posts/flask-extensions/</guid>
      <description>å‡è®¾æˆ‘æ˜¯ä¸€ä¸ªæ¥å£è´©å­ï¼Œä¸“é—¨æä¾›å„ç§å„æ ·çš„ API ç»™æˆ‘çš„å®¢æˆ·ä»¬ï¼Œä¸»è¦è¿™äº› API åç«¯æ˜¯ç”¨ Python + Flask å®ç°çš„ã€‚æˆ‘éœ€è¦ç®¡ç†å’Œç›‘æ§æˆ‘çš„è¿™äº› API ä»¬ï¼Œçœ‹çœ‹å“ªäº›æ›´å—æ¬¢è¿ï¼Œå“ªäº›å“åº”æ…¢ï¼Œå“ªäº›éœ€è¦æ”¹è¿›ï¼Œäºæ˜¯æˆ‘æƒ³ç»™æˆ‘çš„åç«¯æœåŠ¡åšä¸ª Dashboardï¼Œèƒ½çœ‹åˆ°ä¸Šé¢é‚£äº›æ•°æ®ï¼Œå¹¶ä¸”æƒ³æŠŠè¿™ä¸ªä¸œè¥¿æŠ½è±¡å‡ºæ¥ï¼Œä»¥åæˆ‘è¿˜èƒ½å–å…¶ä»– APIï¼Œè¿˜èƒ½ç”¨åœ¨æˆ‘çš„å…¶ä»–é¡¹ç›®ä¸Šï¼Œäºæ˜¯ä¹æ‰“ç®—åšæˆä¸€ä¸ªæ’ä»¶ã€‚
 å…ˆå‡è£…æœ‰ä¸€ä¸ªå­˜æ•°æ®çš„å®¢æˆ·ç«¯ï¼ŒğŸ‘‡
class APIDogClient: &amp;#39;&amp;#39;&amp;#39;APIDog: æ”¶é›†æ¥å£æœåŠ¡çš„å„ç§ä¿¡æ¯ï¼Œè¯·æ±‚è€—æ—¶ï¼Œè¯·æ±‚è·¯å¾„ï¼Œè¯·æ±‚ IP ç­‰ç­‰ç­‰ç­‰&amp;#39;&amp;#39;&amp;#39; def __init__(self, secret_key): self.host = &amp;#39;x.x.x.x&amp;#39; # å‡è£…æˆ‘æœ‰ä¸€äº›é…ç½®éœ€è¦åˆå§‹åŒ– self.port = &amp;#39;xxx&amp;#39; self.secret_key = secret_key self.secret_id = &amp;#39;xxx&amp;#39; self.bucket = [] def storge(self, data): # clean data self.bucket.append(data) ç°åœ¨å¯ä»¥å¼€å§‹ç€æ‰‹æ’ä»¶äº†ï¼Œç»™æ’ä»¶å–åä¸º flask-APIDogï¼Œç¬¬ä¸€ä»£æ‰“ç®—æ”¶é›†æ¯æ¬¡è¯·æ±‚çš„è·¯å¾„ï¼Œæ¯ä¸ªè¯·æ±‚çš„è€—æ—¶ï¼Œæ¯æ¬¡è¯·æ±‚çš„ IPã€‚æ¯æ¬¡è¯·æ±‚éƒ½è¿™äº›æ•°æ®ä¸€èµ·å‘é€åˆ°æˆ‘çš„ APIDog æœåŠ¡ç«¯å­˜èµ·æ¥ï¼Œå¹¶å±•ç¤ºåˆ° Dashboard ä¸Šã€‚
import time from flask import Flask, request, current_app try: from flask import _app_ctx_stack as stack except ImportError: from flask import _request_ctx_stack as stack class APIDog: &amp;#39;&amp;#39;&amp;#39;Flask-APIDog extendsion&amp;#39;&amp;#39;&amp;#39; def __init__(self, app=None): self.</description>
      <content>&lt;blockquote&gt;
&lt;p&gt;å‡è®¾æˆ‘æ˜¯ä¸€ä¸ªæ¥å£è´©å­ï¼Œä¸“é—¨æä¾›å„ç§å„æ ·çš„ API ç»™æˆ‘çš„å®¢æˆ·ä»¬ï¼Œä¸»è¦è¿™äº› API åç«¯æ˜¯ç”¨ Python + Flask å®ç°çš„ã€‚æˆ‘éœ€è¦ç®¡ç†å’Œç›‘æ§æˆ‘çš„è¿™äº› API ä»¬ï¼Œçœ‹çœ‹å“ªäº›æ›´å—æ¬¢è¿ï¼Œå“ªäº›å“åº”æ…¢ï¼Œå“ªäº›éœ€è¦æ”¹è¿›ï¼Œäºæ˜¯æˆ‘æƒ³ç»™æˆ‘çš„åç«¯æœåŠ¡åšä¸ª Dashboardï¼Œèƒ½çœ‹åˆ°ä¸Šé¢é‚£äº›æ•°æ®ï¼Œå¹¶ä¸”æƒ³æŠŠè¿™ä¸ªä¸œè¥¿æŠ½è±¡å‡ºæ¥ï¼Œä»¥åæˆ‘è¿˜èƒ½å–å…¶ä»– APIï¼Œè¿˜èƒ½ç”¨åœ¨æˆ‘çš„å…¶ä»–é¡¹ç›®ä¸Šï¼Œäºæ˜¯ä¹æ‰“ç®—åšæˆä¸€ä¸ªæ’ä»¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆå‡è£…æœ‰ä¸€ä¸ªå­˜æ•°æ®çš„å®¢æˆ·ç«¯ï¼ŒğŸ‘‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;APIDogClient&lt;/span&gt;:
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&amp;#39;APIDog: æ”¶é›†æ¥å£æœåŠ¡çš„å„ç§ä¿¡æ¯ï¼Œè¯·æ±‚è€—æ—¶ï¼Œè¯·æ±‚è·¯å¾„ï¼Œè¯·æ±‚ IP ç­‰ç­‰ç­‰ç­‰&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, secret_key):
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;host &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;x.x.x.x&amp;#39;&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# å‡è£…æˆ‘æœ‰ä¸€äº›é…ç½®éœ€è¦åˆå§‹åŒ–&lt;/span&gt;
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;port &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;xxx&amp;#39;&lt;/span&gt;
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;secret_key &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; secret_key
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;secret_id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;xxx&amp;#39;&lt;/span&gt;
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;bucket &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []

    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;storge&lt;/span&gt;(self, data):
        &lt;span style=&#34;color:#75715e&#34;&gt;# clean data&lt;/span&gt;
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;bucket&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(data)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å¯ä»¥å¼€å§‹ç€æ‰‹æ’ä»¶äº†ï¼Œç»™æ’ä»¶å–åä¸º &lt;code&gt;flask-APIDog&lt;/code&gt;ï¼Œç¬¬ä¸€ä»£æ‰“ç®—æ”¶é›†æ¯æ¬¡è¯·æ±‚çš„è·¯å¾„ï¼Œæ¯ä¸ªè¯·æ±‚çš„è€—æ—¶ï¼Œæ¯æ¬¡è¯·æ±‚çš„ IPã€‚æ¯æ¬¡è¯·æ±‚éƒ½è¿™äº›æ•°æ®ä¸€èµ·å‘é€åˆ°æˆ‘çš„ APIDog æœåŠ¡ç«¯å­˜èµ·æ¥ï¼Œå¹¶å±•ç¤ºåˆ° Dashboard ä¸Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; time

&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; flask &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; Flask, request, current_app

&lt;span style=&#34;color:#66d9ef&#34;&gt;try&lt;/span&gt;:
    &lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; flask &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; _app_ctx_stack &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; stack
&lt;span style=&#34;color:#66d9ef&#34;&gt;except&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ImportError&lt;/span&gt;:
    &lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; flask &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; _request_ctx_stack &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; stack


&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;APIDog&lt;/span&gt;:
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&amp;#39;Flask-APIDog extendsion&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, app&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;None&lt;/span&gt;):
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;app &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; app
        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; app:
            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;init_app(app)
            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;api_dog &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; APIDogClient(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;config&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;api_dog_secret_key&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;))

    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;init_app&lt;/span&gt;(self, app&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;None&lt;/span&gt;):
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;app &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; app
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;api_dog &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; APIDogClient(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;config&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;api_dog_secret_key&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;))
        app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;before_request(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;_before_request)
        app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;after_request(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;_after_request)

    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_before_request&lt;/span&gt;(self):
        ctx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stack&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;top
        ctx&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;_api_dog_data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;request_begin_time&amp;#39;&lt;/span&gt;: time&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;time()
        }

    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_after_request&lt;/span&gt;(self, response):
        ctx &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stack&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;top
        api_request_begin_time &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ctx&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;_api_dog_data&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;request_path&amp;#39;&lt;/span&gt;, time&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;time())
        request_time &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; time&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;time() &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; api_request_begin_time
        api_data &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;request_time&amp;#39;&lt;/span&gt;: request_time,
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;request_path&amp;#39;&lt;/span&gt;: request&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;path,
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;request_location&amp;#39;&lt;/span&gt;: request&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;args&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;location&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;),
            &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;remote_address&amp;#39;&lt;/span&gt;: request&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;remote_addr
        }
        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;api_dog&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;storge(api_data)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ğŸ‘† æ˜¯ç¬¬ä¸€ç‰ˆçš„ &lt;code&gt;flask-APIDog&lt;/code&gt; çš„ä»£ç ï¼Œå¾ˆç®€å•çš„ä¸€äº›å¤„ç†ï¼Œ Flask æ‰©å±•ä¸€èˆ¬ï¼ˆå®˜æ–¹å»ºè®®ï¼‰æä¾›ä¸€ä¸ª &lt;code&gt;init_app&lt;/code&gt; æ–¹æ³•ï¼Œç”¨äºåœ¨å®ä¾‹åŒ–æ’ä»¶ç±»ååˆå§‹åŒ– Flask APPï¼Œå®é™…ä¸Šè¿™é‡Œåªæ˜¯ç®€å•çš„ç»™ Flask APP çš„ &lt;code&gt;before_request&lt;/code&gt;ï¼Œ&lt;code&gt;after_request&lt;/code&gt; ä¸¤ä¸ªé’©å­å‡½æ•°æä¾›ä¸¤ä¸ªå…·ä½“æµç¨‹ï¼Œ&lt;code&gt;_app_ctx_stack.top&lt;/code&gt; æ˜¯ Flask
é‡Œé¢ä¸Šä¸‹æ–‡çš„æ¦‚å¿µï¼Œæ„æ€æ˜¯å–å½“å‰åº”ç”¨ã€‚æ›´ç”šè‡³å®Œå…¨å¯ä»¥ç›´æ¥ç”¨ &lt;code&gt;before_request&lt;/code&gt;ï¼Œ&lt;code&gt;after_request&lt;/code&gt; è£…é¥°ä¸¤ä¸ªå‡½æ•°æ¥å®ç°ä¸Šé¢é‚£äº›åŠŸèƒ½ï¼Œä½†æ˜¯åé¢è¿­ä»£ç‰ˆæœ¬ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œç›´æ¥å†™åœ¨é¡¹ç›®é‡Œå¾ˆå®¹æ˜“æ±¡æŸ“ç°æœ‰ä»£ç ï¼ŒæŠ½è±¡æˆæ’ä»¶ä¸ä»…æé«˜äº†é²æ£’æ€§ï¼Œè¿˜ç¬¦åˆ Flask çš„æ’ä»¶ç³»ç»Ÿç†å¿µã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•ä¹Ÿä¸ä¸€èˆ¬çš„ Flask æ’ä»¶ä¸€è‡´ï¼ŒğŸ‘‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; flask &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; Flask
&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; flask_apidog &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; APIDog


app &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Flask(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;test_flask_extend&amp;#39;&lt;/span&gt;)
api_dog &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ApiDog()
api_dog&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;init_app(app)

&lt;span style=&#34;color:#a6e22e&#34;&gt;@app&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;route(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;index&lt;/span&gt;():
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hello api dog&amp;#34;&lt;/span&gt;


&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; __name__ &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;__main__&amp;#34;&lt;/span&gt;:
    app&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;run()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·ä¹‹åï¼ŒAPP çš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šè®°å½•è¯·æ±‚è€—æ—¶ï¼Œè¯·æ±‚ IPï¼Œè¯·æ±‚è·¯å¾„å¹¶è½¬å‘åˆ° APIDog åç«¯æœåŠ¡ï¼Œè¿™æ ·ä¸€ä¸ªç®€å•çš„ Flask æ’ä»¶å¤§è‡´å°±å®Œæˆäº†ã€‚&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
